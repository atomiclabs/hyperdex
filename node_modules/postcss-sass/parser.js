'use strict';

exports.__esModule = true;

var _postcss = require('postcss');

var _postcss2 = _interopRequireDefault(_postcss);

var _gonzalesPe = require('gonzales-pe');

var _gonzalesPe2 = _interopRequireDefault(_gonzalesPe);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var DEFAULT_RAWS_ROOT = {
    before: ''
};

var DEFAULT_RAWS_RULE = {
    before: '',
    between: ''
};

var DEFAULT_RAWS_DECL = {
    before: '',
    between: '',
    semicolon: false
};

var DEFAULT_COMMENT_DECL = {
    before: '',
    left: '',
    right: ''
};

var SassParser = function () {
    function SassParser(input) {
        _classCallCheck(this, SassParser);

        this.input = input;
    }

    SassParser.prototype.parse = function parse() {
        try {
            this.node = _gonzalesPe2.default.parse(this.input.css, { syntax: 'sass' });
        } catch (error) {
            throw this.input.error(error.message, error.line, 1);
        }
        this.lines = this.input.css.match(/^.*(\r?\n|$)/gm);
        this.root = this.stylesheet(this.node);
    };

    SassParser.prototype.extractSource = function extractSource(start, end) {
        var nodeLines = this.lines.slice(start.line - 1, end.line);

        nodeLines[0] = nodeLines[0].substring(start.column - 1);
        var last = nodeLines.length - 1;
        nodeLines[last] = nodeLines[last].substring(0, end.column);

        return nodeLines.join('');
    };

    SassParser.prototype.stylesheet = function stylesheet(node) {
        var _this = this;

        // Create and set parameters for Root node
        var root = _postcss2.default.root();
        root.source = {
            start: node.start,
            end: node.end,
            input: this.input
        };
        // Raws for root node
        root.raws = {
            semicolon: DEFAULT_RAWS_ROOT.semicolon,
            before: DEFAULT_RAWS_ROOT.before
        };
        // Store spaces before root (if exist)
        this.raws = {
            before: ''
        };
        node.content.forEach(function (contentNode) {
            return _this.process(contentNode, root);
        });
        return root;
    };

    SassParser.prototype.process = function process(node, parent) {
        if (this[node.type]) {
            return this[node.type](node, parent) || null;
        } else {
            return null;
        }
    };

    SassParser.prototype.ruleset = function ruleset(node, parent) {
        var _this2 = this;

        // Loop to find the deepest ruleset node
        this.raws.multiRuleProp = '';

        node.content.forEach(function (contentNode) {
            switch (contentNode.type) {
                case 'block':
                    {
                        // Create Rule node
                        var rule = _postcss2.default.rule();
                        rule.selector = '';
                        // Object to store raws for Rule
                        var ruleRaws = {
                            before: _this2.raws.before || DEFAULT_RAWS_RULE.before,
                            between: DEFAULT_RAWS_RULE.between
                        };

                        // Variable to store spaces and symbols before declaration property
                        _this2.raws.before = '';
                        _this2.raws.comment = false;

                        // Look up throw all nodes in current ruleset node
                        node.content.filter(function (_ref) {
                            var type = _ref.type;
                            return type === 'block';
                        }).forEach(function (innerContentNode) {
                            return _this2.process(innerContentNode, rule);
                        });

                        if (rule.nodes.length) {
                            // Write selector to Rule
                            rule.selector = _this2.extractSource(node.start, contentNode.start).slice(0, -1).replace(/\s+$/, function (spaces) {
                                ruleRaws.between = spaces;
                                return '';
                            });
                            // Set parameters for Rule node
                            rule.parent = parent;
                            rule.source = {
                                start: node.start,
                                end: node.end,
                                input: _this2.input
                            };
                            rule.raws = ruleRaws;
                            parent.nodes.push(rule);
                        }
                        break;
                    }
                default:
            }
        });
    };

    SassParser.prototype.block = function block(node, parent) {
        var _this3 = this;

        // If nested rules exist, wrap current rule in new rule node
        if (this.raws.multiRule) {
            if (this.raws.multiRulePropVariable) {
                this.raws.multiRuleProp = '$' + this.raws.multiRuleProp;
            }
            var multiRule = Object.assign(_postcss2.default.rule(), {
                source: {
                    start: {
                        line: node.start.line - 1,
                        column: node.start.column
                    },
                    end: node.end,
                    input: this.input
                },
                raws: {
                    before: this.raws.before || DEFAULT_RAWS_RULE.before,
                    between: DEFAULT_RAWS_RULE.between
                },
                parent: parent,
                selector: (this.raws.customProperty ? '--' : '') + this.raws.multiRuleProp
            });
            parent.push(multiRule);
            parent = multiRule;
        }

        this.raws.before = '';

        // Looking for declaration node in block node
        node.content.forEach(function (contentNode) {
            return _this3.process(contentNode, parent);
        });
        if (this.raws.multiRule) {
            this.raws.beforeMulti = this.raws.before;
        }
    };

    SassParser.prototype.declaration = function declaration(node, parent) {
        var _this4 = this;

        var isBlockInside = false;
        // Create Declaration node
        var declarationNode = _postcss2.default.decl();
        declarationNode.prop = '';

        // Object to store raws for Declaration
        var declarationRaws = Object.assign(declarationNode.raws, {
            before: this.raws.before || DEFAULT_RAWS_DECL.before,
            between: DEFAULT_RAWS_DECL.between,
            semicolon: DEFAULT_RAWS_DECL.semicolon
        });

        this.raws.property = false;
        this.raws.betweenBefore = false;
        this.raws.comment = false;
        // Looking for property and value node in declaration node
        node.content.forEach(function (contentNode) {
            switch (contentNode.type) {
                case 'customProperty':
                    _this4.raws.customProperty = true;
                // fall through
                case 'property':
                    {
                        /* global.property to detect is property is already defined in current object */
                        _this4.raws.property = true;
                        _this4.raws.multiRuleProp = contentNode.content[0].content;
                        _this4.raws.multiRulePropVariable = contentNode.content[0].type === 'variable';
                        _this4.process(contentNode, declarationNode);
                        break;
                    }
                case 'propertyDelimiter':
                    {
                        if (_this4.raws.property && !_this4.raws.betweenBefore) {
                            /* If property is already defined and there's no ':' before it */
                            declarationRaws.between += contentNode.content;
                            _this4.raws.multiRuleProp += contentNode.content;
                        } else {
                            /* If ':' goes before property declaration, like :width 100px */
                            _this4.raws.betweenBefore = true;
                            declarationRaws.before += contentNode.content;
                            _this4.raws.multiRuleProp += contentNode.content;
                        }
                        break;
                    }
                case 'space':
                    {
                        declarationRaws.between += contentNode.content;
                        break;
                    }
                case 'value':
                    {
                        // Look up for a value for current property
                        switch (contentNode.content[0].type) {
                            case 'block':
                                {
                                    isBlockInside = true;
                                    // If nested rules exist
                                    if (Array.isArray(contentNode.content[0].content)) {
                                        _this4.raws.multiRule = true;
                                    }
                                    _this4.process(contentNode.content[0], parent);
                                    break;
                                }
                            case 'variable':
                                {
                                    declarationNode.value = '$';
                                    _this4.process(contentNode, declarationNode);
                                    break;
                                }
                            case 'color':
                                {
                                    declarationNode.value = '#';
                                    _this4.process(contentNode, declarationNode);
                                    break;
                                }
                            case 'number':
                                {
                                    if (contentNode.content.length > 1) {
                                        declarationNode.value = contentNode.content.join('');
                                    } else {
                                        _this4.process(contentNode, declarationNode);
                                    }
                                    break;
                                }
                            case 'parentheses':
                                {
                                    declarationNode.value = '(';
                                    _this4.process(contentNode, declarationNode);
                                    break;
                                }
                            default:
                                {
                                    _this4.process(contentNode, declarationNode);
                                }
                        }
                        break;
                    }
                default:
            }
        });

        if (!isBlockInside) {
            // Set parameters for Declaration node
            declarationNode.source = {
                start: node.start,
                end: node.end,
                input: this.input
            };
            declarationNode.parent = parent;
            parent.nodes.push(declarationNode);
        }

        this.raws.before = '';
        this.raws.customProperty = false;
        this.raws.multiRuleProp = '';
        this.raws.property = false;
    };

    SassParser.prototype.customProperty = function customProperty(node, parent) {
        this.property(node, parent);
        parent.prop = '--' + parent.prop;
    };

    SassParser.prototype.property = function property(node, parent) {
        // Set property for Declaration node
        switch (node.content[0].type) {
            case 'variable':
                {
                    parent.prop += '$';
                    break;
                }
            case 'interpolation':
                {
                    this.raws.interpolation = true;
                    parent.prop += '#{';
                    break;
                }
            default:
        }
        parent.prop += node.content[0].content;
        if (this.raws.interpolation) {
            parent.prop += '}';
            this.raws.interpolation = false;
        }
    };

    SassParser.prototype.value = function value(node, parent) {
        if (!parent.value) {
            parent.value = '';
        }
        // Set value for Declaration node
        if (node.content.length) {
            node.content.forEach(function (contentNode) {
                switch (contentNode.type) {
                    case 'important':
                        {
                            parent.raws.important = contentNode.content;
                            parent.important = true;
                            var match = parent.value.match(/^(.*?)(\s*)$/);
                            if (match) {
                                parent.raws.important = match[2] + parent.raws.important;
                                parent.value = match[1];
                            }
                            break;
                        }
                    case 'parentheses':
                        {
                            parent.value += contentNode.content.join('') + ')';
                            break;
                        }
                    default:
                        {
                            if (contentNode.content.constructor === Array) {
                                parent.value += contentNode.content.join('');
                            } else {
                                parent.value += contentNode.content;
                            }
                        }
                }
            });
        }
    };

    SassParser.prototype.singlelineComment = function singlelineComment(node, parent) {
        return this.comment(node, parent, true);
    };

    SassParser.prototype.multilineComment = function multilineComment(node, parent) {
        return this.comment(node, parent, false);
    };

    SassParser.prototype.comment = function comment(node, parent, inline) {
        var text = node.content.match(/^(\s*)((?:\S[\s\S]*?)?)(\s*)$/);

        this.raws.comment = true;

        var comment = Object.assign(_postcss2.default.comment(), {
            text: text[2],
            raws: {
                before: this.raws.before || DEFAULT_COMMENT_DECL.before,
                left: text[1],
                right: text[3],
                inline: inline
            }
        });

        if (this.raws.beforeMulti) {
            comment.raws.before += this.raws.beforeMulti;
            this.raws.beforeMulti = undefined;
        }

        parent.nodes.push(comment);
        this.raws.before = '';
    };

    SassParser.prototype.space = function space(node, parent) {
        // Spaces before root and rule
        switch (parent.type) {
            case 'root':
                {
                    this.raws.before += node.content;
                    break;
                }
            case 'rule':
                {
                    if (this.raws.comment) {
                        this.raws.before += node.content;
                    } else if (this.raws.loop) {
                        parent.selector += node.content;
                    } else {
                        this.raws.before = (this.raws.before || '\n') + node.content;
                    }
                    break;
                }
            default:
        }
    };

    SassParser.prototype.declarationDelimiter = function declarationDelimiter(node) {
        this.raws.before += node.content;
    };

    SassParser.prototype.loop = function loop(node, parent) {
        var _this5 = this;

        var loop = _postcss2.default.rule();
        this.raws.comment = false;
        this.raws.multiRule = false;
        this.raws.loop = true;
        loop.selector = '';
        loop.raws = {
            before: this.raws.before || DEFAULT_RAWS_RULE.before,
            between: DEFAULT_RAWS_RULE.between
        };
        if (this.raws.beforeMulti) {
            loop.raws.before += this.raws.beforeMulti;
            this.raws.beforeMulti = undefined;
        }
        node.content.forEach(function (contentNode, i) {
            if (node.content[i + 1] && node.content[i + 1].type === 'block') {
                _this5.raws.loop = false;
            }
            _this5.process(contentNode, loop);
        });
        parent.nodes.push(loop);
        this.raws.loop = false;
    };

    SassParser.prototype.atkeyword = function atkeyword(node, parent) {
        parent.selector += '@' + node.content;
    };

    SassParser.prototype.operator = function operator(node, parent) {
        parent.selector += node.content;
    };

    SassParser.prototype.variable = function variable(node, parent) {
        if (this.raws.loop) {
            parent.selector += '$' + node.content[0].content;
        } else {
            parent.selector += '#' + node.content[0].content;
        }
    };

    SassParser.prototype.ident = function ident(node, parent) {
        parent.selector += node.content;
    };

    return SassParser;
}();

exports.default = SassParser;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhcnNlci5lczYiXSwibmFtZXMiOlsiREVGQVVMVF9SQVdTX1JPT1QiLCJiZWZvcmUiLCJERUZBVUxUX1JBV1NfUlVMRSIsImJldHdlZW4iLCJERUZBVUxUX1JBV1NfREVDTCIsInNlbWljb2xvbiIsIkRFRkFVTFRfQ09NTUVOVF9ERUNMIiwibGVmdCIsInJpZ2h0IiwiU2Fzc1BhcnNlciIsImlucHV0IiwicGFyc2UiLCJub2RlIiwiY3NzIiwic3ludGF4IiwiZXJyb3IiLCJtZXNzYWdlIiwibGluZSIsImxpbmVzIiwibWF0Y2giLCJyb290Iiwic3R5bGVzaGVldCIsImV4dHJhY3RTb3VyY2UiLCJzdGFydCIsImVuZCIsIm5vZGVMaW5lcyIsInNsaWNlIiwic3Vic3RyaW5nIiwiY29sdW1uIiwibGFzdCIsImxlbmd0aCIsImpvaW4iLCJzb3VyY2UiLCJyYXdzIiwiY29udGVudCIsImZvckVhY2giLCJwcm9jZXNzIiwiY29udGVudE5vZGUiLCJwYXJlbnQiLCJ0eXBlIiwicnVsZXNldCIsIm11bHRpUnVsZVByb3AiLCJydWxlIiwic2VsZWN0b3IiLCJydWxlUmF3cyIsImNvbW1lbnQiLCJmaWx0ZXIiLCJpbm5lckNvbnRlbnROb2RlIiwibm9kZXMiLCJyZXBsYWNlIiwic3BhY2VzIiwicHVzaCIsImJsb2NrIiwibXVsdGlSdWxlIiwibXVsdGlSdWxlUHJvcFZhcmlhYmxlIiwiT2JqZWN0IiwiYXNzaWduIiwiY3VzdG9tUHJvcGVydHkiLCJiZWZvcmVNdWx0aSIsImRlY2xhcmF0aW9uIiwiaXNCbG9ja0luc2lkZSIsImRlY2xhcmF0aW9uTm9kZSIsImRlY2wiLCJwcm9wIiwiZGVjbGFyYXRpb25SYXdzIiwicHJvcGVydHkiLCJiZXR3ZWVuQmVmb3JlIiwiQXJyYXkiLCJpc0FycmF5IiwidmFsdWUiLCJpbnRlcnBvbGF0aW9uIiwiaW1wb3J0YW50IiwiY29uc3RydWN0b3IiLCJzaW5nbGVsaW5lQ29tbWVudCIsIm11bHRpbGluZUNvbW1lbnQiLCJpbmxpbmUiLCJ0ZXh0IiwidW5kZWZpbmVkIiwic3BhY2UiLCJsb29wIiwiZGVjbGFyYXRpb25EZWxpbWl0ZXIiLCJpIiwiYXRrZXl3b3JkIiwib3BlcmF0b3IiLCJ2YXJpYWJsZSIsImlkZW50Il0sIm1hcHBpbmdzIjoiOzs7O0FBQUE7Ozs7QUFDQTs7Ozs7Ozs7QUFFQSxJQUFNQSxvQkFBb0I7QUFDdEJDLFlBQVE7QUFEYyxDQUExQjs7QUFJQSxJQUFNQyxvQkFBb0I7QUFDdEJELFlBQVEsRUFEYztBQUV0QkUsYUFBUztBQUZhLENBQTFCOztBQUtBLElBQU1DLG9CQUFvQjtBQUN0QkgsWUFBUSxFQURjO0FBRXRCRSxhQUFTLEVBRmE7QUFHdEJFLGVBQVc7QUFIVyxDQUExQjs7QUFNQSxJQUFNQyx1QkFBdUI7QUFDekJMLFlBQVEsRUFEaUI7QUFFekJNLFVBQU0sRUFGbUI7QUFHekJDLFdBQU87QUFIa0IsQ0FBN0I7O0lBTU1DLFU7QUFDRix3QkFBWUMsS0FBWixFQUFtQjtBQUFBOztBQUNmLGFBQUtBLEtBQUwsR0FBYUEsS0FBYjtBQUNIOzt5QkFDREMsSyxvQkFBUTtBQUNKLFlBQUk7QUFDQSxpQkFBS0MsSUFBTCxHQUFZLHFCQUFTRCxLQUFULENBQWUsS0FBS0QsS0FBTCxDQUFXRyxHQUExQixFQUErQixFQUFFQyxRQUFRLE1BQVYsRUFBL0IsQ0FBWjtBQUNILFNBRkQsQ0FFRSxPQUFPQyxLQUFQLEVBQWM7QUFDWixrQkFBTSxLQUFLTCxLQUFMLENBQVdLLEtBQVgsQ0FBaUJBLE1BQU1DLE9BQXZCLEVBQWdDRCxNQUFNRSxJQUF0QyxFQUE0QyxDQUE1QyxDQUFOO0FBQ0g7QUFDRCxhQUFLQyxLQUFMLEdBQWEsS0FBS1IsS0FBTCxDQUFXRyxHQUFYLENBQWVNLEtBQWYsQ0FBcUIsZ0JBQXJCLENBQWI7QUFDQSxhQUFLQyxJQUFMLEdBQVksS0FBS0MsVUFBTCxDQUFnQixLQUFLVCxJQUFyQixDQUFaO0FBQ0gsSzs7eUJBQ0RVLGEsMEJBQWNDLEssRUFBT0MsRyxFQUFLO0FBQ3RCLFlBQU1DLFlBQVksS0FBS1As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Szs7Ozs7a0JBR1V6QixVIiwiZmlsZSI6InBhcnNlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBwb3N0Y3NzIGZyb20gJ3Bvc3Rjc3MnO1xuaW1wb3J0IGdvbnphbGVzIGZyb20gJ2dvbnphbGVzLXBlJztcblxuY29uc3QgREVGQVVMVF9SQVdTX1JPT1QgPSB7XG4gICAgYmVmb3JlOiAnJ1xufTtcblxuY29uc3QgREVGQVVMVF9SQVdTX1JVTEUgPSB7XG4gICAgYmVmb3JlOiAnJyxcbiAgICBiZXR3ZWVuOiAnJ1xufTtcblxuY29uc3QgREVGQVVMVF9SQVdTX0RFQ0wgPSB7XG4gICAgYmVmb3JlOiAnJyxcbiAgICBiZXR3ZWVuOiAnJyxcbiAgICBzZW1pY29sb246IGZhbHNlXG59O1xuXG5jb25zdCBERUZBVUxUX0NPTU1FTlRfREVDTCA9IHtcbiAgICBiZWZvcmU6ICcnLFxuICAgIGxlZnQ6ICcnLFxuICAgIHJpZ2h0OiAnJ1xufTtcblxuY2xhc3MgU2Fzc1BhcnNlciB7XG4gICAgY29uc3RydWN0b3IoaW5wdXQpIHtcbiAgICAgICAgdGhpcy5pbnB1dCA9IGlucHV0O1xuICAgIH1cbiAgICBwYXJzZSgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMubm9kZSA9IGdvbnphbGVzLnBhcnNlKHRoaXMuaW5wdXQuY3NzLCB7IHN5bnRheDogJ3Nhc3MnIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhyb3cgdGhpcy5pbnB1dC5lcnJvcihlcnJvci5tZXNzYWdlLCBlcnJvci5saW5lLCAxKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxpbmVzID0gdGhpcy5pbnB1dC5jc3MubWF0Y2goL14uKihcXHI/XFxufCQpL2dtKTtcbiAgICAgICAgdGhpcy5yb290ID0gdGhpcy5zdHlsZXNoZWV0KHRoaXMubm9kZSk7XG4gICAgfVxuICAgIGV4dHJhY3RTb3VyY2Uoc3RhcnQsIGVuZCkge1xuICAgICAgICBjb25zdCBub2RlTGluZXMgPSB0aGlzLmxpbmVzLnNsaWNlKFxuICAgICAgICAgICAgc3RhcnQubGluZSAtIDEsXG4gICAgICAgICAgICBlbmQubGluZVxuICAgICAgICApO1xuXG4gICAgICAgIG5vZGVMaW5lc1swXSA9IG5vZGVMaW5lc1swXS5zdWJzdHJpbmcoc3RhcnQuY29sdW1uIC0gMSk7XG4gICAgICAgIGNvbnN0IGxhc3QgPSBub2RlTGluZXMubGVuZ3RoIC0gMTtcbiAgICAgICAgbm9kZUxpbmVzW2xhc3RdID0gbm9kZUxpbmVzW2xhc3RdLnN1YnN0cmluZygwLCBlbmQuY29sdW1uKTtcblxuICAgICAgICByZXR1cm4gbm9kZUxpbmVzLmpvaW4oJycpO1xuICAgIH1cbiAgICBzdHlsZXNoZWV0KG5vZGUpIHtcbiAgICAgICAgLy8gQ3JlYXRlIGFuZCBzZXQgcGFyYW1ldGVycyBmb3IgUm9vdCBub2RlXG4gICAgICAgIGNvbnN0IHJvb3QgPSBwb3N0Y3NzLnJvb3QoKTtcbiAgICAgICAgcm9vdC5zb3VyY2UgPSB7XG4gICAgICAgICAgICBzdGFydDogbm9kZS5zdGFydCxcbiAgICAgICAgICAgIGVuZDogbm9kZS5lbmQsXG4gICAgICAgICAgICBpbnB1dDogdGhpcy5pbnB1dFxuICAgICAgICB9O1xuICAgICAgICAvLyBSYXdzIGZvciByb290IG5vZGVcbiAgICAgICAgcm9vdC5yYXdzID0ge1xuICAgICAgICAgICAgc2VtaWNvbG9uOiBERUZBVUxUX1JBV1NfUk9PVC5zZW1pY29sb24sXG4gICAgICAgICAgICBiZWZvcmU6IERFRkFVTFRfUkFXU19ST09ULmJlZm9yZVxuICAgICAgICB9O1xuICAgICAgICAvLyBTdG9yZSBzcGFjZXMgYmVmb3JlIHJvb3QgKGlmIGV4aXN0KVxuICAgICAgICB0aGlzLnJhd3MgPSB7XG4gICAgICAgICAgICBiZWZvcmU6ICcnXG4gICAgICAgIH07XG4gICAgICAgIG5vZGUuY29udGVudC5mb3JFYWNoKGNvbnRlbnROb2RlID0+IHRoaXMucHJvY2Vzcyhjb250ZW50Tm9kZSwgcm9vdCkpO1xuICAgICAgICByZXR1cm4gcm9vdDtcbiAgICB9XG4gICAgcHJvY2Vzcyhub2RlLCBwYXJlbnQpIHtcbiAgICAgICAgaWYgKHRoaXNbbm9kZS50eXBlXSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXNbbm9kZS50eXBlXShub2RlLCBwYXJlbnQpIHx8IG51bGw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBydWxlc2V0KG5vZGUsIHBhcmVudCkge1xuICAgICAgICAvLyBMb29wIHRvIGZpbmQgdGhlIGRlZXBlc3QgcnVsZXNldCBub2RlXG4gICAgICAgIHRoaXMucmF3cy5tdWx0aVJ1bGVQcm9wID0gJyc7XG5cbiAgICAgICAgbm9kZS5jb250ZW50LmZvckVhY2goY29udGVudE5vZGUgPT4ge1xuICAgICAgICAgICAgc3dpdGNoIChjb250ZW50Tm9kZS50eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnYmxvY2snOiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBSdWxlIG5vZGVcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcnVsZSA9IHBvc3Rjc3MucnVsZSgpO1xuICAgICAgICAgICAgICAgICAgICBydWxlLnNlbGVjdG9yID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIC8vIE9iamVjdCB0byBzdG9yZSByYXdzIGZvciBSdWxlXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJ1bGVSYXdzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgYmVmb3JlOiB0aGlzLnJhd3MuYmVmb3JlIHx8IERFRkFVTFRfUkFXU19SVUxFLmJlZm9yZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJldHdlZW46IERFRkFVTFRfUkFXU19SVUxFLmJldHdlZW5cbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBWYXJpYWJsZSB0byBzdG9yZSBzcGFjZXMgYW5kIHN5bWJvbHMgYmVmb3JlIGRlY2xhcmF0aW9uIHByb3BlcnR5XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmF3cy5iZWZvcmUgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yYXdzLmNvbW1lbnQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBMb29rIHVwIHRocm93IGFsbCBub2RlcyBpbiBjdXJyZW50IHJ1bGVzZXQgbm9kZVxuICAgICAgICAgICAgICAgICAgICBub2RlLmNvbnRlbnRcbiAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKHsgdHlwZSB9KSA9PiB0eXBlID09PSAnYmxvY2snKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZvckVhY2goaW5uZXJDb250ZW50Tm9kZSA9PiB0aGlzLnByb2Nlc3MoaW5uZXJDb250ZW50Tm9kZSwgcnVsZSkpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChydWxlLm5vZGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gV3JpdGUgc2VsZWN0b3IgdG8gUnVsZVxuICAgICAgICAgICAgICAgICAgICAgICAgcnVsZS5zZWxlY3RvciA9IHRoaXMuZXh0cmFjdFNvdXJjZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLnN0YXJ0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnROb2RlLnN0YXJ0XG4gICAgICAgICAgICAgICAgICAgICAgICApLnNsaWNlKDAsIC0xKS5yZXBsYWNlKC9cXHMrJC8sIHNwYWNlcyA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVsZVJhd3MuYmV0d2VlbiA9IHNwYWNlcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCBwYXJhbWV0ZXJzIGZvciBSdWxlIG5vZGVcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGUucGFyZW50ID0gcGFyZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgcnVsZS5zb3VyY2UgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IG5vZGUuc3RhcnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kOiBub2RlLmVuZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dDogdGhpcy5pbnB1dFxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGUucmF3cyA9IHJ1bGVSYXdzO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50Lm5vZGVzLnB1c2gocnVsZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBibG9jayhub2RlLCBwYXJlbnQpIHtcbiAgICAgICAgLy8gSWYgbmVzdGVkIHJ1bGVzIGV4aXN0LCB3cmFwIGN1cnJlbnQgcnVsZSBpbiBuZXcgcnVsZSBub2RlXG4gICAgICAgIGlmICh0aGlzLnJhd3MubXVsdGlSdWxlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5yYXdzLm11bHRpUnVsZVByb3BWYXJpYWJsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucmF3cy5tdWx0aVJ1bGVQcm9wID0gYFxcJCR7dGhpcy5yYXdzLm11bHRpUnVsZVByb3B9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IG11bHRpUnVsZSA9IE9iamVjdC5hc3NpZ24ocG9zdGNzcy5ydWxlKCksIHtcbiAgICAgICAgICAgICAgICBzb3VyY2U6IHtcbiAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IG5vZGUuc3RhcnQubGluZSAtIDEsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW46IG5vZGUuc3RhcnQuY29sdW1uXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGVuZDogbm9kZS5lbmQsXG4gICAgICAgICAgICAgICAgICAgIGlucHV0OiB0aGlzLmlucHV0XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICByYXdzOiB7XG4gICAgICAgICAgICAgICAgICAgIGJlZm9yZTogdGhpcy5yYXdzLmJlZm9yZSB8fCBERUZBVUxUX1JBV1NfUlVMRS5iZWZvcmUsXG4gICAgICAgICAgICAgICAgICAgIGJldHdlZW46IERFRkFVTFRfUkFXU19SVUxFLmJldHdlZW5cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHBhcmVudCxcbiAgICAgICAgICAgICAgICBzZWxlY3RvcjogKHRoaXMucmF3cy5jdXN0b21Qcm9wZXJ0eSA/ICctLScgOiAnJykgKyB0aGlzLnJhd3MubXVsdGlSdWxlUHJvcFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBwYXJlbnQucHVzaChtdWx0aVJ1bGUpO1xuICAgICAgICAgICAgcGFyZW50ID0gbXVsdGlSdWxlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yYXdzLmJlZm9yZSA9ICcnO1xuXG4gICAgICAgIC8vIExvb2tpbmcgZm9yIGRlY2xhcmF0aW9uIG5vZGUgaW4gYmxvY2sgbm9kZVxuICAgICAgICBub2RlLmNvbnRlbnQuZm9yRWFjaChjb250ZW50Tm9kZSA9PiB0aGlzLnByb2Nlc3MoY29udGVudE5vZGUsIHBhcmVudCkpO1xuICAgICAgICBpZiAodGhpcy5yYXdzLm11bHRpUnVsZSkge1xuICAgICAgICAgICAgdGhpcy5yYXdzLmJlZm9yZU11bHRpID0gdGhpcy5yYXdzLmJlZm9yZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBkZWNsYXJhdGlvbihub2RlLCBwYXJlbnQpIHtcbiAgICAgICAgbGV0IGlzQmxvY2tJbnNpZGUgPSBmYWxzZTtcbiAgICAgICAgLy8gQ3JlYXRlIERlY2xhcmF0aW9uIG5vZGVcbiAgICAgICAgY29uc3QgZGVjbGFyYXRpb25Ob2RlID0gcG9zdGNzcy5kZWNsKCk7XG4gICAgICAgIGRlY2xhcmF0aW9uTm9kZS5wcm9wID0gJyc7XG5cbiAgICAgICAgLy8gT2JqZWN0IHRvIHN0b3JlIHJhd3MgZm9yIERlY2xhcmF0aW9uXG4gICAgICAgIGNvbnN0IGRlY2xhcmF0aW9uUmF3cyA9IE9iamVjdC5hc3NpZ24oZGVjbGFyYXRpb25Ob2RlLnJhd3MsIHtcbiAgICAgICAgICAgIGJlZm9yZTogdGhpcy5yYXdzLmJlZm9yZSB8fCBERUZBVUxUX1JBV1NfREVDTC5iZWZvcmUsXG4gICAgICAgICAgICBiZXR3ZWVuOiBERUZBVUxUX1JBV1NfREVDTC5iZXR3ZWVuLFxuICAgICAgICAgICAgc2VtaWNvbG9uOiBERUZBVUxUX1JBV1NfREVDTC5zZW1pY29sb25cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5yYXdzLnByb3BlcnR5ID0gZmFsc2U7XG4gICAgICAgIHRoaXMucmF3cy5iZXR3ZWVuQmVmb3JlID0gZmFsc2U7XG4gICAgICAgIHRoaXMucmF3cy5jb21tZW50ID0gZmFsc2U7XG4gICAgICAgIC8vIExvb2tpbmcgZm9yIHByb3BlcnR5IGFuZCB2YWx1ZSBub2RlIGluIGRlY2xhcmF0aW9uIG5vZGVcbiAgICAgICAgbm9kZS5jb250ZW50LmZvckVhY2goKGNvbnRlbnROb2RlKSA9PiB7XG4gICAgICAgICAgICBzd2l0Y2ggKGNvbnRlbnROb2RlLnR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdjdXN0b21Qcm9wZXJ0eSc6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmF3cy5jdXN0b21Qcm9wZXJ0eSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIC8vIGZhbGwgdGhyb3VnaFxuICAgICAgICAgICAgICAgIGNhc2UgJ3Byb3BlcnR5Jzoge1xuICAgICAgICAgICAgICAgICAgICAvKiBnbG9iYWwucHJvcGVydHkgdG8gZGV0ZWN0IGlzIHByb3BlcnR5IGlzIGFscmVhZHkgZGVmaW5lZCBpbiBjdXJyZW50IG9iamVjdCAqL1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJhd3MucHJvcGVydHkgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJhd3MubXVsdGlSdWxlUHJvcCA9IGNvbnRlbnROb2RlLmNvbnRlbnRbMF0uY29udGVudDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yYXdzLm11bHRpUnVsZVByb3BWYXJpYWJsZSA9IGNvbnRlbnROb2RlLmNvbnRlbnRbMF0udHlwZSA9PT0gJ3ZhcmlhYmxlJztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzKGNvbnRlbnROb2RlLCBkZWNsYXJhdGlvbk5vZGUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSAncHJvcGVydHlEZWxpbWl0ZXInOiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJhd3MucHJvcGVydHkgJiYgIXRoaXMucmF3cy5iZXR3ZWVuQmVmb3JlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvKiBJZiBwcm9wZXJ0eSBpcyBhbHJlYWR5IGRlZmluZWQgYW5kIHRoZXJlJ3Mgbm8gJzonIGJlZm9yZSBpdCAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVjbGFyYXRpb25SYXdzLmJldHdlZW4gKz0gY29udGVudE5vZGUuY29udGVudDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmF3cy5tdWx0aVJ1bGVQcm9wICs9IGNvbnRlbnROb2RlLmNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvKiBJZiAnOicgZ29lcyBiZWZvcmUgcHJvcGVydHkgZGVjbGFyYXRpb24sIGxpa2UgOndpZHRoIDEwMHB4ICovXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJhd3MuYmV0d2VlbkJlZm9yZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWNsYXJhdGlvblJhd3MuYmVmb3JlICs9IGNvbnRlbnROb2RlLmNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJhd3MubXVsdGlSdWxlUHJvcCArPSBjb250ZW50Tm9kZS5jb250ZW50O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlICdzcGFjZSc6IHtcbiAgICAgICAgICAgICAgICAgICAgZGVjbGFyYXRpb25SYXdzLmJldHdlZW4gKz0gY29udGVudE5vZGUuY29udGVudDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgJ3ZhbHVlJzoge1xuICAgICAgICAgICAgICAgICAgICAvLyBMb29rIHVwIGZvciBhIHZhbHVlIGZvciBjdXJyZW50IHByb3BlcnR5XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoY29udGVudE5vZGUuY29udGVudFswXS50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdibG9jayc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0Jsb2NrSW5zaWRlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiBuZXN0ZWQgcnVsZXMgZXhpc3RcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb250ZW50Tm9kZS5jb250ZW50WzBdLmNvbnRlbnQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmF3cy5tdWx0aVJ1bGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3MoY29udGVudE5vZGUuY29udGVudFswXSwgcGFyZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3ZhcmlhYmxlJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlY2xhcmF0aW9uTm9kZS52YWx1ZSA9ICckJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3MoY29udGVudE5vZGUsIGRlY2xhcmF0aW9uTm9kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdjb2xvcic6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNsYXJhdGlvbk5vZGUudmFsdWUgPSAnIyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzKGNvbnRlbnROb2RlLCBkZWNsYXJhdGlvbk5vZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb250ZW50Tm9kZS5jb250ZW50Lmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVjbGFyYXRpb25Ob2RlLnZhbHVlID0gY29udGVudE5vZGUuY29udGVudC5qb2luKCcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3MoY29udGVudE5vZGUsIGRlY2xhcmF0aW9uTm9kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAncGFyZW50aGVzZXMnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVjbGFyYXRpb25Ob2RlLnZhbHVlID0gJygnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHJvY2Vzcyhjb250ZW50Tm9kZSwgZGVjbGFyYXRpb25Ob2RlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3MoY29udGVudE5vZGUsIGRlY2xhcmF0aW9uTm9kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghaXNCbG9ja0luc2lkZSkge1xuICAgICAgICAgICAgLy8gU2V0IHBhcmFtZXRlcnMgZm9yIERlY2xhcmF0aW9uIG5vZGVcbiAgICAgICAgICAgIGRlY2xhcmF0aW9uTm9kZS5zb3VyY2UgPSB7XG4gICAgICAgICAgICAgICAgc3RhcnQ6IG5vZGUuc3RhcnQsXG4gICAgICAgICAgICAgICAgZW5kOiBub2RlLmVuZCxcbiAgICAgICAgICAgICAgICBpbnB1dDogdGhpcy5pbnB1dFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGRlY2xhcmF0aW9uTm9kZS5wYXJlbnQgPSBwYXJlbnQ7XG4gICAgICAgICAgICBwYXJlbnQubm9kZXMucHVzaChkZWNsYXJhdGlvbk5vZGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yYXdzLmJlZm9yZSA9ICcnO1xuICAgICAgICB0aGlzLnJhd3MuY3VzdG9tUHJvcGVydHkgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yYXdzLm11bHRpUnVsZVByb3AgPSAnJztcbiAgICAgICAgdGhpcy5yYXdzLnByb3BlcnR5ID0gZmFsc2U7XG4gICAgfVxuICAgIGN1c3RvbVByb3BlcnR5KG5vZGUsIHBhcmVudCkge1xuICAgICAgICB0aGlzLnByb3BlcnR5KG5vZGUsIHBhcmVudCk7XG4gICAgICAgIHBhcmVudC5wcm9wID0gYC0tJHtwYXJlbnQucHJvcH1gO1xuICAgIH1cbiAgICBwcm9wZXJ0eShub2RlLCBwYXJlbnQpIHtcbiAgICAgICAgLy8gU2V0IHByb3BlcnR5IGZvciBEZWNsYXJhdGlvbiBub2RlXG4gICAgICAgIHN3aXRjaCAobm9kZS5jb250ZW50WzBdLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ3ZhcmlhYmxlJzoge1xuICAgICAgICAgICAgICAgIHBhcmVudC5wcm9wICs9ICckJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgJ2ludGVycG9sYXRpb24nOiB7XG4gICAgICAgICAgICAgICAgdGhpcy5yYXdzLmludGVycG9sYXRpb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgIHBhcmVudC5wcm9wICs9ICcjeyc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICB9XG4gICAgICAgIHBhcmVudC5wcm9wICs9IG5vZGUuY29udGVudFswXS5jb250ZW50O1xuICAgICAgICBpZiAodGhpcy5yYXdzLmludGVycG9sYXRpb24pIHtcbiAgICAgICAgICAgIHBhcmVudC5wcm9wICs9ICd9JztcbiAgICAgICAgICAgIHRoaXMucmF3cy5pbnRlcnBvbGF0aW9uID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdmFsdWUobm9kZSwgcGFyZW50KSB7XG4gICAgICAgIGlmICghcGFyZW50LnZhbHVlKSB7XG4gICAgICAgICAgICBwYXJlbnQudmFsdWUgPSAnJztcbiAgICAgICAgfVxuICAgICAgICAvLyBTZXQgdmFsdWUgZm9yIERlY2xhcmF0aW9uIG5vZGVcbiAgICAgICAgaWYgKG5vZGUuY29udGVudC5sZW5ndGgpIHtcbiAgICAgICAgICAgIG5vZGUuY29udGVudC5mb3JFYWNoKGNvbnRlbnROb2RlID0+IHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGNvbnRlbnROb2RlLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnaW1wb3J0YW50Jzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LnJhd3MuaW1wb3J0YW50ID0gY29udGVudE5vZGUuY29udGVudDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5pbXBvcnRhbnQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSBwYXJlbnQudmFsdWUubWF0Y2goL14oLio/KShcXHMqKSQvKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5yYXdzLmltcG9ydGFudCA9IG1hdGNoWzJdICsgcGFyZW50LnJhd3MuaW1wb3J0YW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC52YWx1ZSA9IG1hdGNoWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncGFyZW50aGVzZXMnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQudmFsdWUgKz0gY29udGVudE5vZGUuY29udGVudC5qb2luKCcnKSArICcpJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb250ZW50Tm9kZS5jb250ZW50LmNvbnN0cnVjdG9yID09PSBBcnJheSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC52YWx1ZSArPSBjb250ZW50Tm9kZS5jb250ZW50LmpvaW4oJycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQudmFsdWUgKz0gY29udGVudE5vZGUuY29udGVudDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNpbmdsZWxpbmVDb21tZW50KG5vZGUsIHBhcmVudCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb21tZW50KG5vZGUsIHBhcmVudCwgdHJ1ZSk7XG4gICAgfVxuICAgIG11bHRpbGluZUNvbW1lbnQobm9kZSwgcGFyZW50KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbW1lbnQobm9kZSwgcGFyZW50LCBmYWxzZSk7XG4gICAgfVxuICAgIGNvbW1lbnQobm9kZSwgcGFyZW50LCBpbmxpbmUpIHtcbiAgICAgICAgY29uc3QgdGV4dCA9IG5vZGUuY29udGVudC5tYXRjaCgvXihcXHMqKSgoPzpcXFNbXFxzXFxTXSo/KT8pKFxccyopJC8pO1xuXG4gICAgICAgIHRoaXMucmF3cy5jb21tZW50ID0gdHJ1ZTtcblxuICAgICAgICBjb25zdCBjb21tZW50ID0gT2JqZWN0LmFzc2lnbihwb3N0Y3NzLmNvbW1lbnQoKSwge1xuICAgICAgICAgICAgdGV4dDogdGV4dFsyXSxcbiAgICAgICAgICAgIHJhd3M6IHtcbiAgICAgICAgICAgICAgICBiZWZvcmU6IHRoaXMucmF3cy5iZWZvcmUgfHwgREVGQVVMVF9DT01NRU5UX0RFQ0wuYmVmb3JlLFxuICAgICAgICAgICAgICAgIGxlZnQ6IHRleHRbMV0sXG4gICAgICAgICAgICAgICAgcmlnaHQ6IHRleHRbM10sXG4gICAgICAgICAgICAgICAgaW5saW5lXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICh0aGlzLnJhd3MuYmVmb3JlTXVsdGkpIHtcbiAgICAgICAgICAgIGNvbW1lbnQucmF3cy5iZWZvcmUgKz0gdGhpcy5yYXdzLmJlZm9yZU11bHRpO1xuICAgICAgICAgICAgdGhpcy5yYXdzLmJlZm9yZU11bHRpID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG5cbiAgICAgICAgcGFyZW50Lm5vZGVzLnB1c2goY29tbWVudCk7XG4gICAgICAgIHRoaXMucmF3cy5iZWZvcmUgPSAnJztcbiAgICB9XG4gICAgc3BhY2Uobm9kZSwgcGFyZW50KSB7XG4gICAgICAgIC8vIFNwYWNlcyBiZWZvcmUgcm9vdCBhbmQgcnVsZVxuICAgICAgICBzd2l0Y2ggKHBhcmVudC50eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdyb290Jzoge1xuICAgICAgICAgICAgICAgIHRoaXMucmF3cy5iZWZvcmUgKz0gbm9kZS5jb250ZW50O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSAncnVsZSc6IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yYXdzLmNvbW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yYXdzLmJlZm9yZSArPSBub2RlLmNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnJhd3MubG9vcCkge1xuICAgICAgICAgICAgICAgICAgICBwYXJlbnQuc2VsZWN0b3IgKz0gbm9kZS5jb250ZW50O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmF3cy5iZWZvcmUgPSAodGhpcy5yYXdzLmJlZm9yZSB8fCAnXFxuJykgKyBub2RlLmNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgfVxuICAgIH1cbiAgICBkZWNsYXJhdGlvbkRlbGltaXRlcihub2RlKSB7XG4gICAgICAgIHRoaXMucmF3cy5iZWZvcmUgKz0gbm9kZS5jb250ZW50O1xuICAgIH1cbiAgICBsb29wKG5vZGUsIHBhcmVudCkge1xuICAgICAgICBjb25zdCBsb29wID0gcG9zdGNzcy5ydWxlKCk7XG4gICAgICAgIHRoaXMucmF3cy5jb21tZW50ID0gZmFsc2U7XG4gICAgICAgIHRoaXMucmF3cy5tdWx0aVJ1bGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yYXdzLmxvb3AgPSB0cnVlO1xuICAgICAgICBsb29wLnNlbGVjdG9yID0gJyc7XG4gICAgICAgIGxvb3AucmF3cyA9IHtcbiAgICAgICAgICAgIGJlZm9yZTogdGhpcy5yYXdzLmJlZm9yZSB8fCBERUZBVUxUX1JBV1NfUlVMRS5iZWZvcmUsXG4gICAgICAgICAgICBiZXR3ZWVuOiBERUZBVUxUX1JBV1NfUlVMRS5iZXR3ZWVuXG4gICAgICAgIH07XG4gICAgICAgIGlmICh0aGlzLnJhd3MuYmVmb3JlTXVsdGkpIHtcbiAgICAgICAgICAgIGxvb3AucmF3cy5iZWZvcmUgKz0gdGhpcy5yYXdzLmJlZm9yZU11bHRpO1xuICAgICAgICAgICAgdGhpcy5yYXdzLmJlZm9yZU11bHRpID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIG5vZGUuY29udGVudC5mb3JFYWNoKChjb250ZW50Tm9kZSwgaSkgPT4ge1xuICAgICAgICAgICAgaWYgKG5vZGUuY29udGVudFtpICsgMV0gJiYgbm9kZS5jb250ZW50W2kgKyAxXS50eXBlID09PSAnYmxvY2snKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yYXdzLmxvb3AgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucHJvY2Vzcyhjb250ZW50Tm9kZSwgbG9vcCk7XG4gICAgICAgIH0pO1xuICAgICAgICBwYXJlbnQubm9kZXMucHVzaChsb29wKTtcbiAgICAgICAgdGhpcy5yYXdzLmxvb3AgPSBmYWxzZTtcbiAgICB9XG4gICAgYXRrZXl3b3JkKG5vZGUsIHBhcmVudCkge1xuICAgICAgICBwYXJlbnQuc2VsZWN0b3IgKz0gYEAke25vZGUuY29udGVudH1gO1xuICAgIH1cbiAgICBvcGVyYXRvcihub2RlLCBwYXJlbnQpIHtcbiAgICAgICAgcGFyZW50LnNlbGVjdG9yICs9IG5vZGUuY29udGVudDtcbiAgICB9XG4gICAgdmFyaWFibGUobm9kZSwgcGFyZW50KSB7XG4gICAgICAgIGlmICh0aGlzLnJhd3MubG9vcCkge1xuICAgICAgICAgICAgcGFyZW50LnNlbGVjdG9yICs9IGBcXCQke25vZGUuY29udGVudFswXS5jb250ZW50fWA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwYXJlbnQuc2VsZWN0b3IgKz0gYFxcIyR7bm9kZS5jb250ZW50WzBdLmNvbnRlbnR9YDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZGVudChub2RlLCBwYXJlbnQpIHtcbiAgICAgICAgcGFyZW50LnNlbGVjdG9yICs9IG5vZGUuY29udGVudDtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFNhc3NQYXJzZXI7XG4iXX0=