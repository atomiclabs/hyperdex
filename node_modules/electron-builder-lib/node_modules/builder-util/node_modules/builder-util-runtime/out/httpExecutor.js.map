{"version":3,"file":"httpExecutor.js","sourceRoot":"","sources":["../src/httpExecutor.ts"],"names":[],"mappings":"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","sourcesContent":["import { createHash, Hash } from \"crypto\"\nimport _debug from \"debug\"\nimport { createWriteStream } from \"fs-extra-p\"\nimport { IncomingMessage, OutgoingHttpHeaders, RequestOptions } from \"http\"\nimport { Socket } from \"net\"\nimport { Transform } from \"stream\"\nimport { parse as parseUrl, URL } from \"url\"\nimport { CancellationToken } from \"./CancellationToken\"\nimport { newError } from \"./index\"\nimport { ProgressCallbackTransform, ProgressInfo } from \"./ProgressCallbackTransform\"\n\nconst debug = _debug(\"electron-builder\")\n\nexport interface RequestHeaders extends OutgoingHttpHeaders {\n  [key: string]: string\n}\n\nexport interface DownloadOptions {\n  readonly headers?: OutgoingHttpHeaders | null\n  readonly skipDirCreation?: boolean\n  readonly sha2?: string | null\n  readonly sha512?: string | null\n\n  readonly cancellationToken: CancellationToken\n\n  // noinspection JSUnusedLocalSymbols\n  onProgress?(progress: ProgressInfo): void\n}\n\nexport function createHttpError(response: IncomingMessage, description: any | null = null) {\n  return new HttpError(response.statusCode || -1, `${response.statusCode} ${response.statusMessage}` + (description == null ? \"\" : (\"\\n\" + JSON.stringify(description, null, \"  \"))) + \"\\nHeaders: \" + safeStringifyJson(response.headers), description)\n}\n\nconst HTTP_STATUS_CODES = new Map<number, string>([\n  [429, \"Too many requests\"],\n  [400, \"Bad request\"],\n  [403, \"Forbidden\"],\n  [404, \"Not found\"],\n  [405, \"Method not allowed\"],\n  [406, \"Not acceptable\"],\n  [408, \"Request timeout\"],\n  [413, \"Request entity too large\"],\n  [500, \"Internal server error\"],\n  [502, \"Bad gateway\"],\n  [503, \"Service unavailable\"],\n  [504, \"Gateway timeout\"],\n  [505, \"HTTP version not supported\"],\n])\n\nexport class HttpError extends Error {\n  constructor(readonly statusCode: number, message: string = `HTTP error: ${HTTP_STATUS_CODES.get(statusCode) || statusCode}`, readonly description: any | null = null) {\n    super(message)\n\n    this.name = \"HttpError\"\n  }\n}\n\nexport function parseJson(result: Promise<string | null>) {\n  return result.then(it => it == null || it.length === 0 ? null : JSON.parse(it))\n}\n\nexport abstract class HttpExecutor<REQUEST> {\n  protected readonly maxRedirects = 10\n\n  request(options: RequestOptions, cancellationToken: CancellationToken = new CancellationToken(), data?: { [name: string]: any; } | null): Promise<string | null> {\n    configureRequestOptions(options)\n    const encodedData = data == null ? undefined : Buffer.from(JSON.stringify(data))\n    if (encodedData != null) {\n      options.method = \"post\"\n      options.headers![\"Content-Type\"] = \"application/json\"\n      options.headers![\"Content-Length\"] = encodedData.length\n    }\n    return this.doApiRequest(options, cancellationToken, it => (it as any).end(encodedData))\n  }\n\n  doApiRequest(options: RequestOptions, cancellationToken: CancellationToken, requestProcessor: (request: REQUEST, reject: (error: Error) => void) => void, redirectCount: number = 0): Promise<string> {\n    if (debug.enabled) {\n      debug(`Request: ${safeStringifyJson(options)}`)\n    }\n\n    return cancellationToken.createPromise<string>((resolve, reject, onCancel) => {\n      const request = this.doRequest(options, (response: any) => {\n        try {\n          this.handleResponse(response, options, cancellationToken, resolve, reject, redirectCount, requestProcessor)\n        }\n        catch (e) {\n          reject(e)\n        }\n      })\n      this.addErrorAndTimeoutHandlers(request, reject)\n      this.addRedirectHandlers(request, options, reject, redirectCount, options => {\n        this.doApiRequest(options, cancellationToken, requestProcessor, redirectCount)\n          .then(resolve)\n          .catch(reject)\n      })\n      requestProcessor(request, reject)\n      onCancel(() => request.abort())\n    })\n  }\n\n  // noinspection JSUnusedLocalSymbols\n  protected addRedirectHandlers(request: any, options: RequestOptions, reject: (error: Error) => void, redirectCount: number, handler: (options: RequestOptions) => void) {\n    // not required for NodeJS\n  }\n\n  addErrorAndTimeoutHandlers(request: any, reject: (error: Error) => void) {\n    this.addTimeOutHandler(request, reject)\n    request.on(\"error\", reject)\n    request.on(\"aborted\", () => {\n      reject(new Error(\"Request has been aborted by the server\"))\n    })\n  }\n\n  protected handleResponse(response: IncomingMessage, options: RequestOptions, cancellationToken: CancellationToken, resolve: (data?: any) => void, reject: (error: Error) => void, redirectCount: number, requestProcessor: (request: REQUEST, reject: (error: Error) => void) => void) {\n    if (debug.enabled) {\n      debug(`Response: ${response.statusCode} ${response.statusMessage}, request options: ${safeStringifyJson(options)}`)\n    }\n\n    // we handle any other >= 400 error on request end (read detailed message in the response body)\n    if (response.statusCode === 404) {\n      // error is clear, we don't need to read detailed error description\n      reject(createHttpError(response, `method: ${options.method} url: ${options.protocol || \"https:\"}//${options.hostname}${options.path}\n\nPlease double check that your authentication token is correct. Due to security reasons actual status maybe not reported, but 404.\n`))\n      return\n    }\n    else if (response.statusCode === 204) {\n      // on DELETE request\n      resolve()\n      return\n    }\n\n    const redirectUrl = safeGetHeader(response, \"location\")\n    if (redirectUrl != null) {\n      if (redirectCount > 10) {\n        reject(new Error(\"Too many redirects (> 10)\"))\n        return\n      }\n\n      this.doApiRequest(HttpExecutor.prepareRedirectUrlOptions(redirectUrl, options), cancellationToken, requestProcessor, redirectCount)\n        .then(resolve)\n        .catch(reject)\n      return\n    }\n\n    let data = \"\"\n    response.setEncoding(\"utf8\")\n    response.on(\"data\", (chunk: string) => data += chunk)\n\n    response.on(\"end\", () => {\n      try {\n        if (response.statusCode != null && response.statusCode >= 400) {\n          const contentType = safeGetHeader(response, \"content-type\")\n          const isJson = contentType != null && (Array.isArray(contentType) ? contentType.find(it => it.includes(\"json\")) != null : contentType.includes(\"json\"))\n          reject(createHttpError(response, isJson ? JSON.parse(data) : data))\n        }\n        else {\n          resolve(data.length === 0 ? null : data)\n        }\n      }\n      catch (e) {\n        reject(e)\n      }\n    })\n  }\n\n  // noinspection JSUnusedLocalSymbols\n  abstract doRequest(options: any, callback: (response: any) => void): any\n\n  protected doDownload(requestOptions: any, destination: string, redirectCount: number, options: DownloadOptions, callback: (error: Error | null) => void, onCancel: (callback: () => void) => void) {\n    const request = this.doRequest(requestOptions, (response: IncomingMessage) => {\n      if (response.statusCode! >= 400) {\n        callback(new Error(`Cannot download \"${requestOptions.protocol || \"https:\"}//${requestOptions.hostname}${requestOptions.path}\", status ${response.statusCode}: ${response.statusMessage}`))\n        return\n      }\n\n      const redirectUrl = safeGetHeader(response, \"location\")\n      if (redirectUrl != null) {\n        if (redirectCount < this.maxRedirects) {\n          this.doDownload(HttpExecutor.prepareRedirectUrlOptions(redirectUrl, requestOptions), destination, redirectCount++, options, callback, onCancel)\n        }\n        else {\n          callback(new Error(`Too many redirects (> ${this.maxRedirects})`))\n        }\n        return\n      }\n\n      configurePipes(options, response, destination, callback, options.cancellationToken)\n    })\n    this.addErrorAndTimeoutHandlers(request, callback)\n    this.addRedirectHandlers(request, requestOptions, callback, redirectCount, requestOptions => {\n      this.doDownload(requestOptions, destination, redirectCount++, options, callback, onCancel)\n    })\n    onCancel(() => request.abort())\n    request.end()\n  }\n\n  protected addTimeOutHandler(request: any, callback: (error: Error) => void) {\n    request.on(\"socket\", (socket: Socket) => {\n      socket.setTimeout(60 * 1000, () => {\n        callback(new Error(\"Request timed out\"))\n        request.abort()\n      })\n    })\n  }\n\n  static prepareRedirectUrlOptions(redirectUrl: string, options: RequestOptions): RequestOptions {\n    const newOptions = configureRequestOptionsFromUrl(redirectUrl, {...options})\n    if (newOptions.headers != null && newOptions.headers.Authorization != null && (newOptions.headers!!.Authorization as string).startsWith(\"token\")) {\n      const parsedNewUrl = new URL(redirectUrl)\n      if (parsedNewUrl.hostname.endsWith(\".amazonaws.com\")) {\n        delete newOptions.headers.Authorization\n      }\n    }\n    return newOptions\n  }\n}\n\nexport function configureRequestOptionsFromUrl(url: string, options: RequestOptions) {\n  const parsedUrl = parseUrl(url)\n  options.protocol = parsedUrl.protocol\n  options.hostname = parsedUrl.hostname\n  if (parsedUrl.port == null) {\n    if (options.port != null) {\n      delete options.port\n    }\n  }\n  else {\n    options.port = parsedUrl.port\n  }\n  options.path = parsedUrl.path\n  return configureRequestOptions(options)\n}\n\nexport class DigestTransform extends Transform {\n  private readonly digester: Hash\n\n  private _actual: string | null = null\n\n  // noinspection JSUnusedGlobalSymbols\n  get actual() {\n    return this._actual\n  }\n\n  isValidateOnEnd: boolean = true\n\n  constructor(readonly expected: string, private readonly algorithm: string = \"sha512\", private readonly encoding: \"hex\" | \"base64\" | \"latin1\" = \"base64\") {\n    super()\n\n    this.digester = createHash(algorithm)\n  }\n\n  // noinspection JSUnusedGlobalSymbols\n  _transform(chunk: Buffer, encoding: string, callback: any) {\n    this.digester.update(chunk)\n    callback(null, chunk)\n  }\n\n  // noinspection JSUnusedGlobalSymbols\n  _flush(callback: any): void {\n    this._actual = this.digester.digest(this.encoding)\n\n    if (this.isValidateOnEnd) {\n      try {\n        this.validate()\n      }\n      catch (e) {\n        callback(e)\n        return\n      }\n    }\n\n    callback(null)\n  }\n\n  validate() {\n    if (this._actual == null) {\n      throw newError(\"Not finished yet\", \"ERR_STREAM_NOT_FINISHED\")\n    }\n\n    if (this._actual !== this.expected) {\n      throw newError(`${this.algorithm} checksum mismatch, expected ${this.expected}, got ${this._actual}`, \"ERR_CHECKSUM_MISMATCH\")\n    }\n\n    return null\n  }\n}\n\nfunction checkSha2(sha2Header: string | null | undefined, sha2: string | null | undefined, callback: (error: Error | null) => void): boolean {\n  if (sha2Header != null && sha2 != null) {\n    // todo why bintray doesn't send this header always\n    if (sha2Header == null) {\n      callback(new Error(\"checksum is required, but server response doesn't contain X-Checksum-Sha2 header\"))\n      return false\n    }\n    else if (sha2Header !== sha2) {\n      callback(new Error(`checksum mismatch: expected ${sha2} but got ${sha2Header} (X-Checksum-Sha2 header)`))\n      return false\n    }\n  }\n  return true\n}\n\nexport function safeGetHeader(response: any, headerKey: string) {\n  const value = response.headers[headerKey]\n  if (value == null) {\n    return null\n  }\n  else if (Array.isArray(value)) {\n    // electron API\n    return value.length === 0 ? null : value[value.length - 1]\n  }\n  else {\n    return value\n  }\n}\n\nfunction configurePipes(options: DownloadOptions, response: any, destination: string, callback: (error: Error | null) => void, cancellationToken: CancellationToken) {\n  if (!checkSha2(safeGetHeader(response, \"X-Checksum-Sha2\"), options.sha2, callback)) {\n    return\n  }\n\n  const streams: Array<any> = []\n  if (options.onProgress != null) {\n    const contentLength = safeGetHeader(response, \"content-length\")\n    if (contentLength != null) {\n      streams.push(new ProgressCallbackTransform(parseInt(contentLength, 10), options.cancellationToken, options.onProgress))\n    }\n  }\n\n  const sha512 = options.sha512\n  if (sha512 != null) {\n    streams.push(new DigestTransform(sha512, \"sha512\", sha512.length === 128 && !sha512.includes(\"+\") && !sha512.includes(\"Z\") && !sha512.includes(\"=\") ? \"hex\" : \"base64\"))\n  }\n  else if (options.sha2 != null) {\n    streams.push(new DigestTransform(options.sha2, \"sha256\", \"hex\"))\n  }\n\n  const fileOut = createWriteStream(destination)\n  streams.push(fileOut)\n\n  let lastStream = response\n  for (const stream of streams) {\n    stream.on(\"error\", (error: Error) => {\n      if (!cancellationToken.cancelled) {\n        callback(error)\n      }\n    })\n    lastStream = lastStream.pipe(stream)\n  }\n\n  fileOut.on(\"finish\", () => {\n    (fileOut.close as any)(callback)\n  })\n}\n\nexport function configureRequestOptions(options: RequestOptions, token?: string | null, method?: \"GET\" | \"DELETE\" | \"PUT\"): RequestOptions {\n  if (method != null) {\n    options.method = method\n  }\n\n  let headers = options.headers\n  if (headers == null) {\n    headers = {}\n    options.headers = headers\n  }\n  if (token != null) {\n    (headers as any).authorization = token.startsWith(\"Basic\") ? token : `token ${token}`\n  }\n  if (headers[\"User-Agent\"] == null) {\n    headers[\"User-Agent\"] = \"electron-builder\"\n  }\n\n  if ((method == null || method === \"GET\") || headers[\"Cache-Control\"] == null) {\n    headers[\"Cache-Control\"] = \"no-cache\"\n  }\n\n  // do not specify for node (in any case we use https module)\n  if (options.protocol == null && (process.versions as any).electron != null) {\n    options.protocol = \"https:\"\n  }\n  return options\n}\n\nexport function safeStringifyJson(data: any, skippedNames?: Set<string>) {\n  return JSON.stringify(data, (name, value) => {\n    if (name.endsWith(\"authorization\") || name.endsWith(\"Password\") || name.endsWith(\"PASSWORD\") || name.endsWith(\"Token\") || name.includes(\"password\") || name.includes(\"token\") || (skippedNames != null && skippedNames.has(name))) {\n      return \"<stripped sensitive data>\"\n    }\n    return value\n  }, 2)\n}"]}
