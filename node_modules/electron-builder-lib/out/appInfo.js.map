{"version":3,"file":"appInfo.js","sourceRoot":"","sources":["../src/appInfo.ts"],"names":[],"mappings":"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","sourcesContent":["import { isEmptyOrSpaces, log, smarten } from \"builder-util\"\nimport sanitizeFileName from \"sanitize-filename\"\nimport { prerelease, SemVer } from \"semver\"\nimport { Packager } from \"./packager\"\n\nexport class AppInfo {\n  readonly description = smarten(this.info.metadata.description || \"\")\n  readonly version: string\n\n  readonly buildNumber: string | undefined\n  readonly buildVersion: string\n\n  readonly productName: string\n  readonly productFilename: string\n\n  constructor(private readonly info: Packager, buildVersion?: string | null) {\n    this.version = info.metadata.version!\n\n    if (buildVersion == null) {\n      buildVersion = info.config.buildVersion\n    }\n\n    this.buildNumber = process.env.BUILD_NUMBER || process.env.TRAVIS_BUILD_NUMBER || process.env.APPVEYOR_BUILD_NUMBER || process.env.CIRCLE_BUILD_NUM || process.env.BUILD_BUILDNUMBER\n    if (buildVersion == null) {\n      buildVersion = this.version\n      if (!isEmptyOrSpaces(this.buildNumber)) {\n        buildVersion += `.${this.buildNumber}`\n      }\n    }\n    this.buildVersion = buildVersion\n\n    this.productName = info.config.productName || info.metadata.productName || info.metadata.name!\n    this.productFilename = sanitizeFileName(this.productName)\n  }\n\n  get channel(): string | null {\n    const prereleaseInfo = prerelease(this.version)\n    if (prereleaseInfo != null && prereleaseInfo.length > 0) {\n      return prereleaseInfo[0]\n    }\n    return null\n  }\n\n  get versionInWeirdWindowsForm(): string {\n    const parsedVersion = new SemVer(this.version)\n    // https://github.com/electron-userland/electron-builder/issues/2635#issuecomment-371792272\n    let buildNumber = this.buildNumber\n    if (buildNumber == null || !/^\\d+$/.test(buildNumber)) {\n      buildNumber = \"0\"\n    }\n    return `${parsedVersion.major}.${parsedVersion.minor}.${parsedVersion.patch}.${buildNumber}`\n  }\n\n  private get notNullDevMetadata() {\n    return this.info.devMetadata || {}\n  }\n\n  get companyName(): string | null {\n    const author = this.info.metadata.author || this.notNullDevMetadata.author\n    return author == null ? null : author.name\n  }\n\n  get id(): string {\n    let appId\n    if (this.info.config.appId != null) {\n      appId = this.info.config.appId\n    }\n\n    const generateDefaultAppId = () => {\n      return `com.electron.${this.info.metadata.name!.toLowerCase()}`\n    }\n\n    if (appId != null && (appId === \"your.id\" || isEmptyOrSpaces(appId))) {\n      const incorrectAppId = appId\n      appId = generateDefaultAppId()\n      log.warn(`do not use \"${incorrectAppId}\" as appId, \"${appId}\" will be used instead`)\n    }\n\n    return appId == null ? generateDefaultAppId() : appId\n  }\n\n  get macBundleIdentifier(): string {\n    return filterCFBundleIdentifier(this.id)\n  }\n\n  get name(): string {\n    return this.info.metadata.name!\n  }\n\n  get sanitizedName(): string {\n    return sanitizeFileName(this.name)\n  }\n\n  get copyright(): string {\n    const copyright = this.info.config.copyright\n    if (copyright != null) {\n      return copyright\n    }\n    return `Copyright Â© ${new Date().getFullYear()} ${this.companyName || this.productName}`\n  }\n\n  async computePackageUrl(): Promise<string | null> {\n    const url = this.info.metadata.homepage || this.notNullDevMetadata.homepage\n    if (url != null) {\n      return url\n    }\n\n    const info = await this.info.repositoryInfo\n    return info == null || info.type !== \"github\"  ? null : `https://${info.domain}/${info.user}/${info.project}`\n  }\n}\n\n/** @internal */\nexport function filterCFBundleIdentifier(identifier: string) {\n  // Remove special characters and allow only alphanumeric (A-Z,a-z,0-9), hyphen (-), and period (.)\n  // Apple documentation: https://developer.apple.com/library/mac/documentation/General/Reference/InfoPlistKeyReference/Articles/CoreFoundationKeys.html#//apple_ref/doc/uid/20001431-102070\n  return identifier.replace(/ /g, \"-\").replace(/[^a-zA-Z0-9.-]/g, \"\")\n}"]}
