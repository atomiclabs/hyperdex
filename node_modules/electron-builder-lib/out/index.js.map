{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,AAAO,AAAE,AAAc,AAAE,AAAM,AAA0B;;;;;;;;;;AAEzD,AAAO,AAAE,AAAG,AAAE,AAAM,AAAc;;;;;;;;;;AAClC,AAAO,AAAE,AAAQ,AAAE,AAAM,AAAY;;;;;;;;;;AAErC,AAAO,AAAE,AAAc,AAAE,AAAM,AAA0B,AAEzD,AAAO,AAAE,AAAQ,AAAe,AAAM,AAAY;;;;;;;;;;AAElD,AAAO,AAAuB,AAAQ,AAAE,AAAM,AAAE,AAAU,AAAqF,AAAc,AAAoB,AAAM,AAAQ,AAC/L,AAAO,AAAE,AAAa,AAAE,AAAI,AAAE,AAAc,AAAE,AAAM,AAAc;;;;;;;;;;AAalE,AAAO,AAAE,AAAO,AAAE,AAAM,AAAW;;;;;;;;;;AAGnC,AAAO,AAAE,AAAiB,AAAgB,AAAM,AAAsB,AAEtE,AAAO,AAAE,AAAc,AAAE,AAAM,AAA0B;;;;;;;;;;AACzD,AAAO,AAAE,AAAgB,AAAE,AAAM,AAAoB;;;;;;;;;;AAErD,AAAO,AAAE,AAAU,AAAgB,AAAM,AAAe,AAExD,AAAM;;;;;;;;;;;2CAAC,AAAK,WAAgB,AAAyC,SAAE,WAAqB,KAAI,AAAQ,sBAAC,AAAO,AAAC;AAC/G,AAAwF;AACxF,UAAM,AAAa,gBAAG,IAAI,AAAG,AAAU;AACvC,AAAQ,aAAC,AAAe,gBAAC,AAAK,AAAC,AAAE;AAC/B,UAAI,AAAK,MAAC,AAAI,QAAI,AAAI,MAAE;AACtB,AAAa,sBAAC,AAAG,IAAC,AAAK,MAAC,AAAI,AAAC;AAC9B,AACH;AAAC,AAAC;AAEF,UAAM,AAAc,iBAAG,KAAI,AAAc,kCAAC,AAAQ,UAAE,AAAO,AAAC;;AAC5D,UAAM,AAAa,gBAAG,AAAG,AAAE;AACzB,AAAG,yBAAC,AAAI,KAAC,AAAqB,AAAC;;AAC/B,AAAQ,eAAC,AAAiB,kBAAC,AAAM,AAAE;AACnC,AAAc,qBAAC,AAAW,AAAE,AAC9B;AAAC;;AACD,AAAO,YAAC,AAAI,KAAC,AAAQ,UAAE,AAAa,AAAC;AAErC,WAAO,qCAAqB,AAAQ,SAAC,AAAK,AAAE,QAAC,AAAI,KAAC,AAAG,AAAE,MAAC,AAAK,MAAC,AAAI,KAAC,AAAa,AAAC,AAAC,iBAAE,AAAa,AAAC,AAAE;AAClG,UAAI,AAAqB;;AACzB,UAAI,AAAa,eAAE;AACjB,AAAc,uBAAC,AAAW,AAAE;AAC5B,AAAO,kBAAG,AAAO,QAAC,AAAO,QAAC,AAAI,AAAC;AAChC,aACI;AACH,AAAO,kBAAG,AAAc,eAAC,AAAU,AAAE;AACtC;;AAED,aAAO,AAAO,QACX,AAAI,KAAC,AAAG,AAAE,MAAC,AAAO,QAAC,AAAc,eAAC,AAAQ,UAAE,AAAa,AAAC,AAAC,AAChE;AAAC,AAAC,AACJ,KAbe,AAAc;AAa5B","sourcesContent":["import { executeFinally } from \"builder-util/out/promise\"\nimport { PublishOptions } from \"electron-publish/out/publisher\"\nimport { log } from \"builder-util\"\nimport { Packager } from \"./packager\"\nimport { PackagerOptions } from \"./packagerApi\"\nimport { PublishManager } from \"./publish/PublishManager\"\n\nexport { Packager, BuildResult } from \"./packager\"\nexport { PackagerOptions, ArtifactCreated } from \"./packagerApi\"\nexport { TargetConfiguration, Platform, Target, DIR_TARGET, BeforeBuildContext, SourceRepositoryInfo, TargetSpecificOptions, TargetConfigType, DEFAULT_TARGET, CompressionLevel } from \"./core\"\nexport { getArchSuffix, Arch, archFromString } from \"builder-util\"\nexport { Configuration, AfterPackContext, MetadataDirectories, ElectronDownloadOptions } from \"./configuration\"\nexport { PlatformSpecificBuildOptions, AsarOptions, FileSet, Protocol, ReleaseInfo } from \"./options/PlatformSpecificBuildOptions\"\nexport { FileAssociation } from \"./options/FileAssociation\"\nexport { MacConfiguration, DmgOptions, MasConfiguration, MacOsTargetName, PkgOptions, DmgContent, DmgWindow } from \"./options/macOptions\"\nexport { WindowsConfiguration } from \"./options/winOptions\"\nexport { AppXOptions } from \"./options/AppXOptions\"\nexport { MsiOptions } from \"./options/MsiOptions\"\nexport { CommonWindowsInstallerConfiguration } from \"./options/CommonWindowsInstallerConfiguration\"\nexport { NsisOptions, NsisWebOptions, PortableOptions, CommonNsisOptions } from \"./targets/nsis/nsisOptions\"\nexport { LinuxConfiguration, DebOptions, CommonLinuxOptions, LinuxTargetSpecificOptions, AppImageOptions } from \"./options/linuxOptions\"\nexport { SnapOptions } from \"./options/SnapOptions\"\nexport { Metadata, AuthorMetadata, RepositoryInfo } from \"./options/metadata\"\nexport { AppInfo } from \"./appInfo\"\nexport { SquirrelWindowsOptions } from \"./options/SquirrelWindowsOptions\"\nexport { WindowsSignOptions, CustomWindowsSignTaskConfiguration, WindowsSignTaskConfiguration, CustomWindowsSign, FileCodeSigningInfo, CertificateFromStoreInfo } from \"./windowsCodeSign\"\nexport { CancellationToken, ProgressInfo } from \"builder-util-runtime\"\nexport { PublishOptions, UploadTask } from \"electron-publish\"\nexport { PublishManager } from \"./publish/PublishManager\"\nexport { PlatformPackager } from \"./platformPackager\"\nexport { Framework, PrepareApplicationStageDirectoryOptions } from \"./Framework\"\nexport { buildForge, ForgeOptions } from \"./forge-maker\"\n\nexport async function build(options: PackagerOptions & PublishOptions, packager: Packager = new Packager(options)): Promise<Array<string>> {\n  // because artifact event maybe dispatched several times for different publish providers\n  const artifactPaths = new Set<string>()\n  packager.artifactCreated(event => {\n    if (event.file != null) {\n      artifactPaths.add(event.file)\n    }\n  })\n\n  const publishManager = new PublishManager(packager, options)\n  const sigIntHandler = () => {\n    log.warn(\"cancelled by SIGINT\")\n    packager.cancellationToken.cancel()\n    publishManager.cancelTasks()\n  }\n  process.once(\"SIGINT\", sigIntHandler)\n\n  return await executeFinally(packager.build().then(() => Array.from(artifactPaths)), errorOccurred => {\n    let promise: Promise<any>\n    if (errorOccurred) {\n      publishManager.cancelTasks()\n      promise = Promise.resolve(null)\n    }\n    else {\n      promise = publishManager.awaitTasks()\n    }\n\n    return promise\n      .then(() => process.removeListener(\"SIGINT\", sigIntHandler))\n  })\n}"]}
