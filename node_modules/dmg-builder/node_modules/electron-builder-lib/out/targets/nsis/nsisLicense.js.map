{"version":3,"file":"nsisLicense.js","sourceRoot":"","sources":["../../../src/targets/nsis/nsisLicense.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAA,AAAO,AAAE,AAAI,AAAE,AAAM,AAAwB;;;;;;;;;;AAC7C,AAAO,AAAE,AAAe,AAAE,AAA2B,AAAE,AAAM,AAA0B;;;;;;;;;;AACvF,AAAO,AAAK,AAAI,AAAM,AAAM;;AAI5B,AAAO,AAAE,AAAgB,AAAE,AAAM,AAAY,AAE7C,AAAM;;;;;;;;;;;;;2CAAC,AAAK,WAA6B,AAAqB,UAAE,AAAoB,SAAE,AAAoC,iBAAE,AAAwB;AAClJ,UAAM,AAAO,UAAG,MAAM,AAA2B,4CAAC,AAAO,QAAC,AAAO,SAAE,AAAQ,AAAC;;AAC5E,QAAI,AAAO,WAAI,AAAI,MAAE;AACnB,UAAI,AAA0B;;AAC9B,UAAI,AAAO,QAAC,AAAQ,SAAC,AAAO,AAAC,UAAE;AAC7B,AAAW,sBAAG,CACZ,AAAkD,oDAClD,AAAsB,wBACtB,AAA0C,4CAC1C,AAA2B,6BAC3B,AAA+D,iEAC/D,AAAa,AAEb,iDAAkC,AAAI,KAAC,AAAI,KAAC,AAAgB,8BAAE,AAAmB,AAAC,oBAAG,AACtF;AACF,aACI;AACH,AAAW,sBAAG,AAAC,mCAAkC,AAAO,OAAG,AAAC;AAC7D;;AAED,AAAe,sBAAC,AAAK,MAAC,AAAa,eAAE,AAAW,AAAC;;AACjD,UAAI,AAAO,QAAC,AAAQ,SAAC,AAAO,AAAC,UAAE;AAC7B,AAAe,wBAAC,AAAK,MAAC,AAAiB,mBAAE,AAAC,2CAA0C,AAAO,OAAG,AAAC,AAAC;AACjG;;AACD,AAAM;AACP;;AAED,UAAM,AAAY,eAAG,MAAM,AAAe,gCAAC,AAAQ,AAAC;;AACpD,QAAI,AAAY,aAAC,AAAM,WAAK,AAAC,GAAE;AAC7B,AAAM;AACP;;AAED,UAAM,AAAW,cAAkB,AAAE;AACrC,UAAM,AAAgB,mBAAG,IAAI,AAAG,IAAC,AAAS,AAAC;AAE3C,QAAI,AAAW,cAAkB,AAAI;;AACrC,SAAK,MAAM,AAAI,QAAI,AAAY,cAAE;AAC/B,AAAgB,uBAAC,AAAM,OAAC,AAAI,KAAC,AAAc,AAAC;;AAC5C,UAAI,AAAW,eAAI,AAAI,MAAE;AACvB,AAAW,sBAAG,AAAI,KAAC,AAAI;AACxB;;AACD,AAAW,kBAAC,AAAI,AAAC,qCAAgC,AAAI,cAAC,AAAI,KAAC,AAAc,AAAC,mBAAI,AAAI,KAAC,AAAI,SAAK,AAAI,KAAC,AAAI,IAAG,AAAC;AAC1G;;AAED,SAAK,MAAM,AAAC,KAAI,AAAgB,kBAAE;AAChC,AAAW,kBAAC,AAAI,AAAC,qCAAgC,AAAI,cAAC,AAAC,AAAC,OAAK,AAAW,WAAG,AAAC;AAC7E;;AAED,AAAW,gBAAC,AAAI,KAAC,AAA+C,AAAC;AACjE,AAAe,oBAAC,AAAK,MAAC,AAAa,eAAE,AAAW,AAAC,AACnD;AAAC","sourcesContent":["import { lcid } from \"builder-util/out/langs\"\nimport { getLicenseFiles, getNotLocalizedLicenseFiles } from \"builder-util/out/license\"\nimport * as path from \"path\"\nimport { WinPackager } from \"../../winPackager\"\nimport { NsisOptions } from \"./nsisOptions\"\nimport { NsisScriptGenerator } from \"./nsisScriptGenerator\"\nimport { nsisTemplatesDir } from \"./nsisUtil\"\n\nexport async function computeLicensePage(packager: WinPackager, options: NsisOptions, scriptGenerator: NsisScriptGenerator, languages: Array<string>): Promise<void> {\n  const license = await getNotLocalizedLicenseFiles(options.license, packager)\n  if (license != null) {\n    let licensePage: Array<string>\n    if (license.endsWith(\".html\")) {\n      licensePage = [\n        \"!define MUI_PAGE_CUSTOMFUNCTION_SHOW LicenseShow\",\n        \"Function LicenseShow\",\n        \"  FindWindow $R0 `#32770` `` $HWNDPARENT\",\n        \"  GetDlgItem $R0 $R0 1000\",\n        \"EmbedHTML::Load /replace $R0 file://$PLUGINSDIR\\\\license.html\",\n        \"FunctionEnd\",\n\n        `!insertmacro MUI_PAGE_LICENSE \"${path.join(nsisTemplatesDir, \"empty-license.txt\")}\"`,\n      ]\n    }\n    else {\n      licensePage = [`!insertmacro MUI_PAGE_LICENSE \"${license}\"`]\n    }\n\n    scriptGenerator.macro(\"licensePage\", licensePage)\n    if (license.endsWith(\".html\")) {\n      scriptGenerator.macro(\"addLicenseFiles\", [`File /oname=$PLUGINSDIR\\\\license.html \"${license}\"`])\n    }\n    return\n  }\n\n  const licenseFiles = await getLicenseFiles(packager)\n  if (licenseFiles.length === 0) {\n    return\n  }\n\n  const licensePage: Array<string> = []\n  const unspecifiedLangs = new Set(languages)\n\n  let defaultFile: string | null = null\n  for (const item of licenseFiles) {\n    unspecifiedLangs.delete(item.langWithRegion)\n    if (defaultFile == null) {\n      defaultFile = item.file\n    }\n    licensePage.push(`LicenseLangString MUILicense ${lcid[item.langWithRegion] || item.lang} \"${item.file}\"`)\n  }\n\n  for (const l of unspecifiedLangs) {\n    licensePage.push(`LicenseLangString MUILicense ${lcid[l]} \"${defaultFile}\"`)\n  }\n\n  licensePage.push('!insertmacro MUI_PAGE_LICENSE \"$(MUILicense)\"')\n  scriptGenerator.macro(\"licensePage\", licensePage)\n}\n"]}
