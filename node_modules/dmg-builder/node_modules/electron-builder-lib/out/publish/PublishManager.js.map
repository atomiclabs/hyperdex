{"version":3,"file":"PublishManager.js","sourceRoot":"","sources":["../../src/publish/PublishManager.ts"],"names":[],"mappings":";;;;;;;;;AAAA,AAAO,AAAe,AAAM,AAAc;;;;;;;;;;AAC1C,AAAO,AAAE,AAAI,AAAE,AAAO,AAAE,AAAgB,AAAE,AAAyB,AAAE,AAAe,AAAE,AAAa,AAAE,AAAG,AAAE,AAAiB,AAAE,AAAe,AAAE,AAAM,AAAc;;;;;;;;;;AAClK,AAAO,AAA2D,AAAwB,AAAiB,AAAS,AAAyC,AAAM,AAAsB;;;;;;;;;;AACzL,AAAO,AAAM,AAAM,AAAO;;AAC1B,AAAO,AAAE,AAAQ,AAA6C,AAAM,AAAkB;;;;;;;;;;AACtF,AAAO,AAAE,AAAgB,AAAE,AAAM,AAAuC;;;;;;;;;;AACxE,AAAO,AAAE,AAAe,AAAE,AAAM,AAAsC;;;;;;;;;;AACtE,AAAO,AAAE,AAAa,AAAE,AAAM,AAAoC;;;;;;;;;;AAClE,AAAO,AAAE,AAAS,AAAE,AAAM,AAAY;;;;;;;;;;AACtC,AAAO,AAAI,AAAM,AAAO;;;;;;;;;;AACxB,AAAO,AAAK,AAAI,AAAM,AAAM;;AAE5B,AAAO,AAAK,AAAG,AAAM,AAAK;;;;;;;;;;AAC1B,AAAO,AAAmB,AAAQ,AAAwC,AAAM,AAAU;;;;;;;;;;AAI1F,AAAO,AAAE,AAAqB,AAAsB,AAAoB,AAAE,AAAM,AAAqB;;;;;;;;;;;4CA0WrG,AAAK,WAAmC,AAA+B,UAAE,AAA6B,SAAE,AAAiB,MAAE,AAAsB;;gDA6C/I,AAAK;AACH,cAAM,AAAI,OAAG,MAAM,AAAQ,SAAC,AAAI,KAAC,AAAc;;AAC/C,YAAI,AAAI,QAAI,AAAI,MAAE;AAChB,iBAAO,AAAI;AACZ;;AAED,cAAM,AAAO,AAAG,UAA2M;;AAC3N,YAAI,AAAa,eAAE;AACjB,gBAAM,IAAI,AAAK,MAAC,AAAO,AAAC;AACzB,eACI;AACH,AAAG,6BAAC,AAAI,KAAC,AAAO,AAAC;;AACjB,iBAAO,AAAI;AACZ,AACH;AAAC;;;;;;;AA1DD,AAAO,gCAAO,AAAO,AAAC;AACtB,AAAmB,wBAAC,AAAO,SAAE,AAAQ,UAAE,AAAI,AAAC;AAE5C,QAAI,AAAqB,wBAAkB,AAAI;;AAC/C,QAAK,AAAgC,QAAC,AAAO,WAAI,AAAI,QAAI,AAAqB,sBAAC,AAAQ,AAAC,WAAE;AACxF,AAAqB,8BAAG,AAAQ,SAAC,AAAO,QAAC,AAAO;AACjD;;AAED,UAAM,AAAQ,WAAG,AAAO,QAAC,AAAQ;;AACjC,QAAI,AAAQ,aAAK,AAAS,WAAE;AAC1B,YAAM,AAAC,IAAG,AAA+B;;AACzC,UAAI,AAAC,EAAC,AAAG,OAAI,AAAI,MAAE;AACjB,cAAM,KAAI,AAAyB,AAAC,0CAAkD,AAAC;AACxF;;AAED,UAAI,AAAqB,yBAAI,AAAI,MAAE;AAChC,AAAS,UAAC,AAAO,UAAG,AAAqB;AAC3C;;AACD,aAAO,AAAO;AACf;;AAED,UAAM,AAAa,gBAAG,AAAoB,qBAAC,AAAO,QAAC,AAAQ,AAAC;;AAC5D,QAAI,AAAa,iBAAI,AAAI,QAAI,AAAa,cAAC,AAAsB,0BAAI,AAAI,MAAE;AACzE,YAAM,AAAa,cAAC,AAAsB,uBAAC,AAAO,SAAE,AAAqB,uBAAE,AAAa,AAAC;AACzF,aAAO,AAAO;AACf;;AAED,UAAM,AAAQ,WAAG,AAAQ,aAAK,AAAQ;;AACtC,QAAI,CAAC,AAAQ,YAAI,AAAQ,aAAK,AAAS,WAAE;AACvC,aAAO,AAAO;AACf;;AAED,QAAI,AAAK,QAAG,AAAQ,AAAC,AAAC,WAAE,AAAyB,QAAC,AAAK,AAAC,AAAC,QAAE,AAA0B,QAAC,AAAK;AAC3F,QAAI,AAAO,UAAG,AAAQ,AAAC,AAAC,WAAE,AAAyB,QAAC,AAAI,AAAC,AAAC,OAAE,AAA0B,QAAC,AAAO;;AAE9F,QAAI,AAAQ,YAAI,AAAK,SAAI,AAAI,QAAI,AAAO,WAAI,AAAI,MAAE;AAChD,YAAM,AAAK,QAAG,AAAO,QAAC,AAAO,QAAC,AAAG,AAAC;;AAClC,UAAI,AAAK,QAAG,AAAC,GAAE;AACb,cAAM,AAAI,OAAG,AAAO;AACpB,AAAO,kBAAG,AAAI,KAAC,AAAS,UAAC,AAAC,GAAE,AAAK,AAAC;AAClC,AAAK,gBAAG,AAAI,KAAC,AAAS,UAAC,AAAK,QAAG,AAAC,AAAC;AAClC;AACF;;AAkBD,QAAI,CAAC,AAAK,SAAI,CAAC,AAAO,SAAE;AACtB,AAAG,yBAAC,AAAK;AAAE,AAAM,gBAAE,AAA8C;AAAE,AAAQ;AAAE,AAAK;AAAE,AAAO,AAAC;AAAlF,SAAoF,AAAiB,AAAC;;AAChH,YAAM,AAAI,OAAG,MAAM,AAAO,AAAE;;AAC5B,UAAI,AAAI,QAAI,AAAI,MAAE;AAChB,eAAO,AAAI;AACZ;;AAED,UAAI,CAAC,AAAK,OAAE;AACV,AAAK,gBAAG,AAAI,KAAC,AAAI;AAClB;;AACD,UAAI,CAAC,AAAO,SAAE;AACZ,AAAO,kBAAG,AAAI,KAAC,AAAO;AACvB;AACF;;AAED,QAAI,AAAQ;AACV,UAAK,AAAyB,QAAC,AAAK,SAAI,AAAI,QAAI,CAAE,AAAyB,QAAC,AAAO,SAAE;AACnF,AAAG,2BAAC,AAAI,KAAC,AAAyJ,AAAC;AACpK,OAHW,CAIZ,AAA2D;;;AAC3D;AAAQ,AAAK;AAAE,AAAI,cAAE,AAAO;OAArB,EAA0B,AAAO,AAAkB;AAC3D,WACI;AACH,AAA2D;AAC3D;AAAQ,AAAK;AAAE,AAAO,iBAAE,AAAO;OAAxB,EAA6B,AAAO,AAAmB;AAC/D,AACH;AAAC;;;;;;;;;;;;AA/bD,MAAM,AAAmB,sBAAG,AAAsK,yKAChM,AAA6L;AAE/L,MAAM,AAAK,QAAG,AAAM,qBAAC,AAA0B,AAAC,AAEhD,AAAM;;;AAWJ,cAA6B,AAAkB,UAAmB,AAA8B,gBAAW,oBAAuC,AAAQ,SAAC,AAAiB;;;AAA/I,SAAQ,WAAR,AAAQ,AAAU;AAAmB,SAAc,iBAAd,AAAc,AAAgB;AAAW,SAAiB,oBAAjB,AAAiB,AAAgD;AAV3J,SAAe,kBAAG,IAAI,AAAG,AAA4B;AAIrD,SAAS,YAAY,AAAK;AAElC,SAAQ,WAAI,AAAO,QAAC,AAAyB,OAAC,AAAK,AAAC,AAAC,QAAC,KAAI,AAAa,AAAE,AAAC,AAAC,oCAAC,AAAI;AAExE,SAAmB,sBAA8B,AAAE;AAGlE,AAAI,SAAC,AAAW,cAAG,KAAI,AAAgB,iCAAC,AAAiB,AAAC;AAE1D,UAAM,AAAiB,oBAAG,AAAO,QAAC,AAAG,IAAC,AAAwB,6BAAK,AAAM;;AACzE,QAAI,CAAC,AAAa,AAAE,uCAAI,AAAiB,mBAAE;AACzC,UAAI,AAAc,eAAC,AAAO,YAAK,AAAS,WAAE;AACxC,YAAI,AAAO,QAAC,AAAG,IAAC,AAAmB,wBAAK,AAAS,WAAE;AACjD,AAAc,yBAAC,AAAO,UAAG,AAAQ;AAClC,eACI;AACH,gBAAM,AAAG,MAAG,AAAQ,AAAE;;AACtB,cAAI,AAAG,OAAI,AAAI,MAAE;AACf,AAAG,+BAAC,AAAI;AAAE,AAAM,sBAAE,AAAgB;AAAE,AAAG,AAAC;AAA/B,eAAiC,AAA6B,AAAC;;AACxE,AAAc,2BAAC,AAAO,UAAG,AAAO;AACjC,iBACI,IAAI,AAAI,iBAAE;AACb,AAAG,+BAAC,AAAI;AAAE,AAAM,sBAAE,AAAa,AAAC;AAAvB,eAAyB,AAAqD,AAAC;;AACxF,AAAc,2BAAC,AAAO,UAAG,AAAc;AACxC;AACF;AACF;;AAED,YAAM,AAAa,gBAAG,AAAc,eAAC,AAAO;AAC5C,AAAI,WAAC,AAAS,YAAG,AAAa,iBAAI,AAAI,QAAI,AAAc,eAAC,AAAO,YAAK,AAAO,AAAI,YAAC,AAAa,kBAAK,AAAO,WAAI,AAAQ,AAAE,sCAAI,AAAI,AAAC;;AACjI,UAAI,AAAI,KAAC,AAAS,aAAI,AAAiB,mBAAE;AACvC,AAAG,2BAAC,AAAI,KAAC,AAAmB,AAAC;AAC9B;AACF,WACI,IAAI,AAAc,eAAC,AAAO,YAAK,AAAO,SAAE;AAC3C,AAAG,yBAAC,AAAI;AACN,AAAM,gBAAE,AAAyC;AACjD,AAAQ,AAAE,qFAAmE,AAAmB,mBAAE,AACnG;AAHQ,SAGN,AAA4B,AAAC;AACjC;;AAED,AAAQ,aAAC,AAAmB;+CAAC,AAAK,WAAC,AAAK,AAAC,AAAE;AACzC,cAAM,AAAQ,WAAG,AAAK,MAAC,AAAQ;;AAC/B,YAAI,AAAK,MAAC,AAAoB,yBAAK,AAAQ,UAAE;AAC3C,cAAI,CAAC,AAAK,MAAC,AAAO,QAAC,AAAI,KAAC,AAAE,AAAC,AAAE,MAAC,AAAE,GAAC,AAAI,SAAK,AAAK,SAAI,AAAE,GAAC,AAAI,SAAK,AAAK,AAAC,QAAE;AACrE,AAAM;AACP;AACF,mBACQ,AAAQ,SAAC,AAAQ,aAAK,AAAQ,kBAAC,AAAO,SAAE;AAC/C,cAAI,CAAC,AAAK,MAAC,AAAO,QAAC,AAAI,KAAC,AAAE,AAAC,AAAE,MAAC,AAAuB,wBAAC,AAAE,AAAC,AAAC,MAAE;AAC1D,AAAM;AACP;AACF,SAJI,MAKA;AACH,AAAM;AACP;;AAED,cAAM,AAAa,gBAAG,MAAM,AAAgC,iCAAC,AAAQ,UAAE,AAAK,MAAC,AAAI,MAAE,AAAI,MAAC,AAAS,AAAC;;AAClG,YAAI,AAAa,iBAAI,AAAI,MAAE;AACzB,gBAAM,AAAS,2BAAC,AAAI,KAAC,AAAI,KAAC,AAAQ,SAAC,AAAe,gBAAC,AAAK,MAAC,AAAS,AAAC,YAAE,AAAgB,AAAC,mBAAE,AAAe,oCAAC,AAAa,AAAC,AAAC;AACxH,AACH;AAAC,AAAC;;;;;;AAEF,AAAQ,aAAC,AAAe,gBAAC,AAAK,AAAC,AAAE;AAC/B,YAAM,AAAoB,uBAAG,AAAK,MAAC,AAAa;;AAChD,UAAI,AAAoB,wBAAI,AAAI,MAAE;AAChC,AAAI,aAAC,AAAW,YAAC,AAAO,QAAC,AAAI,KAAC,AAAe,gBAAC,AAAK,AAAC,AAAC;AACtD,aACI,IAAI,AAAI,KAAC,AAAS,WAAE;AACvB,YAAI,AAAK,MAAC,AAAO,SAAE;AACjB,AAAK,AAAC,+CAA+B,AAAI,KAAC,AAAS,eAAM,AAAiB,sCAAC,AAAK,OAAE,IAAI,AAAG,IAAC,CAAC,AAAU,AAAC,AAAC,AAAC,oCAAuB,AAAiB,sCAAC,AAAoB,AAAC,qBAAE,AAAC;AAC1K;;AACD,AAAI,aAAC,AAAc,eAAC,AAAoB,sBAAE,AAAK,AAAC;AACjD,AACH;AAAC,AAAC,AACJ;AAAC;;AAEO,AAAc,iBAAC,AAAmC,eAAE,AAAsB;AAChF,QAAI,AAAa,cAAC,AAAQ,aAAK,AAAS,WAAE;AACxC,AAAM;AACP;;AAED,UAAM,AAAS,YAAG,AAAI,KAAC,AAAoB,qBAAC,AAAa,eAAE,AAAK,MAAC,AAAQ,AAAC;;AAC1E,QAAI,AAAS,aAAI,AAAI,MAAE;AACrB,AAAG,yBAAC,AAAK;AACP,AAAI,cAAE,AAAK,MAAC,AAAI;AAChB,AAAM,gBAAE,AAAmB;AAC3B,AAAa,uBAAE,AAAiB,sCAAC,AAAa,AAAC,AAChD;AAJS,SAIP,AAAe,AAAC;;AACnB,AAAM;AACP;;AAED,UAAM,AAAY,eAAG,AAAS,UAAC,AAAY;;AAC3C,QAAI,AAAI,KAAC,AAAc,eAAC,AAAO,YAAK,AAAc,kBAAI,AAAQ,AAAE,sCAAI,AAAI,QAAI,AAAC,EAAC,AAAY,iBAAK,AAAQ,YAAI,AAAY,iBAAK,AAAS,AAAC,YAAE;AACtI,AAAG,yBAAC,AAAI;AAAE,AAAI,cAAE,AAAK,MAAC,AAAI;AAAE,AAAM,gBAAE,AAAoC;AAAE,AAAa,uBAAE,AAAc,AAAC,AAAE;AAAjG,6BAAqH,AAAY,YAAE,AAAC;;AAC7I,AAAM;AACP;;AAED,AAAI,SAAC,AAAW,YAAC,AAAO,QAAC,AAAS,UAAC,AAAM,OAAC,AAAK,AAAC,AAAC,AACnD;AAAC;;AAEa,AAAe,iBAArB,AAAK,CAAiB,AAAsB;;;;AAClD,YAAM,AAAQ,WAAG,AAAK,MAAC,AAAQ;AAC/B,YAAM,AAAM,SAAG,AAAK,MAAC,AAAM;AAC3B,YAAM,AAAc,iBAAG,AAAK,MAAC,AAAa,iBAAI,AAAI,AAAC,AAAC,OAAC,MAAM,AAAiB,kBAAC,AAAQ,UAAE,AAAM,UAAI,AAAI,AAAC,AAAC,OAAC,AAAI,AAAC,AAAC,OAAC,AAAM,OAAC,AAAO,SAAE,AAAK,MAAC,AAAI,MAAE,AAAI,OAAC,AAAS,AAAC,AAAC,AAAC,aAAC,CAAC,AAAK,MAAC,AAAa,AAAC;;AAElL,UAAI,AAAK,MAAC,AAAO,SAAE;AACjB,AAAK,AAAC,6CAA+B,AAAI,OAAC,AAAS,eAAM,AAAiB,sCAAC,AAAK,OAAE,IAAI,AAAG,IAAC,CAAC,AAAU,AAAC,AAAC,AAAC,qCAAwB,AAAiB,sCAAC,AAAc,AAAC,eAAE,AAAC;AACrK;;AAED,YAAM,AAAS,YAAG,AAAK,MAAC,AAAI;;AAC5B,UAAI,AAAc,kBAAI,AAAI,MAAE;AAC1B,YAAI,AAAI,OAAC,AAAS,WAAE;AAClB,AAAG,6BAAC,AAAK;AAAE,AAAI,kBAAE,AAAS;AAAE,AAAM,oBAAE,AAAoB,AAAC;AAA/C,aAAiD,AAAe,AAAC;AAC5E;;AACD,AAAM;AACP;;AAED,UAAI,AAAI,OAAC,AAAS,WAAE;AAClB,aAAK,MAAM,AAAa,iBAAI,AAAc,gBAAE;AAC1C,cAAI,AAAI,OAAC,AAAiB,kBAAC,AAAS,WAAE;AACpC,AAAG,+BAAC,AAAK;AAAE,AAAI,oBAAE,AAAK,MAAC,AAAI;AAAE,AAAM,sBAAE,AAAW,AAAC;AAAvC,eAAyC,AAAe,AAAC;;AACnE,AAAK;AACN;;AAED,AAAI,iBAAC,AAAc,eAAC,AAAa,eAAE,AAAK,AAAC;AAC1C;AACF;;AAED,UAAI,AAAK,MAAC,AAAiB,qBAAI,AAAM,UAAI,AAAI,QAAI,AAAS,aAAI,AAAI,QAChE,CAAC,AAAI,OAAC,AAAiB,kBAAC,AAAS,AACjC,cAAC,AAAQ,SAAC,AAAQ,aAAK,AAAQ,kBAAC,AAAO,WAAI,AAAuB,wBAAC,AAAM,AAAC,AAAC,UAAE;AAC7E,AAAI,eAAC,AAAW,YAAC,AAAO,QAAC,AAAqB,gDAAC,AAAK,OAAE,AAAc,AAAC,gBAAC,AAAI,KAAC,AAAE,AAAC,AAAE,MAAC,AAAI,OAAC,AAAmB,oBAAC,AAAI,KAAC,GAAG,AAAE,AAAC,AAAC,AAAC;AACxH,AACH;;AAAC;;AAEO,AAAoB,uBAAC,AAAmC,eAAE,AAAuC;AACvG,AAAsC;AACtC,UAAM,AAAgB,mBAAG,AAAiB,sCAAC,AAAa,AAAC;AACzD,QAAI,AAAS,YAAG,AAAI,KAAC,AAAe,gBAAC,AAAG,IAAC,AAAgB,AAAC;;AAC1D,QAAI,AAAS,aAAI,AAAI,MAAE;AACrB,AAAS,kBAAG,AAAe,gBAAC,AAAI,MAAE,AAAgB,iBAAC,AAAI,KAAC,AAAQ,SAAC,AAAQ,SAAE,AAAa,eAAE,AAAI,KAAC,AAAc,AAAC;AAC9G,AAAI,WAAC,AAAe,gBAAC,AAAG,IAAC,AAAgB,kBAAE,AAAS,AAAC;;AACrD,AAAG,yBAAC,AAAI;AAAE,AAAS,mBAAE,AAAW,UAAC,AAAQ,AAAE,AAAC;AAAnC,SAAqC,AAAY,AAAC;AAC5D;;AACD,WAAO,AAAS,AAClB;AAAC,IAED,AAAqC;;;AACrC,AAAW;AACT,AAAI,SAAC,AAAW,YAAC,AAAW,AAAE;AAC9B,AAAI,SAAC,AAAe,gBAAC,AAAK,AAAE,AAC9B;AAAC;;AAEK,AAAU,YAAhB,AAAK;;;;AACH,YAAM,AAAI,OAAC,AAAW,YAAC,AAAU,AAAE;AAEnC,YAAM,AAAmB,sBAAG,AAAI,OAAC,AAAmB;;AACpD,UAAI,AAAI,OAAC,AAAiB,kBAAC,AAAS,aAAI,AAAmB,oBAAC,AAAM,WAAK,AAAC,GAAE;AACxE,AAAM;AACP;;AAED,YAAM,AAAoB,+CAAC,AAAmB,qBAAE,AAAI,OAAC,AAAQ,AAAC;AAC9D,YAAM,AAAI,OAAC,AAAW,YAAC,AAAU,AAAE,AACrC;;AAAC,AACF,AAED,AAAM;;;;;;;4CAAC,AAAK,WAA2C,AAA+B,UAAE,AAAU,MAAE,AAAsB;AACxH,UAAM,AAAc,iBAAG,MAAM,AAA8B,+BAAC,AAAQ,WAAE,MAAM,AAAiB,kBAAC,AAAQ,UAAE,AAAI,MAAE,AAAI,MAAE,AAAa,AAAC,iBAAE,AAAI,AAAC;;AACzI,QAAI,AAAc,kBAAI,AAAI,QAAI,AAAc,eAAC,AAAM,WAAK,AAAC,GAAE;AACzD,aAAO,AAAI;AACZ;;AAED,QAAI,AAAa,gBAAG,AAAc,eAAC,AAAC,AAAC;;AAErC,QAAI,AAAQ,SAAC,AAAQ,aAAK,AAAQ,kBAAC,AAAO,WAAI,AAAa,cAAC,AAAa,iBAAI,AAAI,MAAE;AACjF,YAAM,AAAW,cAAG,AAAuB;;AAC3C,UAAI,AAAW,YAAC,AAA8B,gCAAE;AAC9C,cAAM,AAAa,gBAAG,MAAM,AAAW,YAAC,AAAqB,sBAAC,AAAK;;AACnE,YAAI,AAAa,iBAAI,AAAI,MAAE;AACzB,AAAa,4CAAO,AAAa;AAAE,AAAa,AAAC;;AAClD;AACF;AACF;;AACD,WAAO,AAAa,AACtB;AAAC,AAED,AAAM;;;;;;;;;;4CAAC,AAAK,WAAyC,AAA+B,UAAE,AAAkD,gBAAE,AAAiB;AACzJ,QAAI,AAAc,mBAAK,AAAI,MAAE;AAC3B,aAAO,AAAI;AACZ;;AAED,QAAI,AAAc,eAAC,AAAM,WAAK,AAAC,GAAE;AAC/B,AAAG,yBAAC,AAAK,MAAC,AAAI,MAAE,AAAiF,AAAC,oFAClG,AAA0F;AAC1F,AAAkK;;;AAClK,YAAM,AAAc,iBAAG,MAAM,AAAQ,SAAC,AAAI,KAAC,AAAc;AACzD,AAAK,AAAC,+CAAmC,AAAiB,sCAAC,AAAc,AAAC,eAAE,AAAC;;AAC7E,UAAI,AAAc,kBAAI,AAAI,QAAI,AAAc,eAAC,AAAI,SAAK,AAAQ,UAAE;AAC9D,cAAM,AAAqB,wBAAG,+BAA+B,AAAQ;AAAG,AAAQ,oBAAE,AAAc,eAAC,AAAI,AAAC;AAA/B,SAAnC,AAAwB,EAA4C,AAAI,MAAE,AAAK,AAAC;;AACpH,YAAI,AAAqB,yBAAI,AAAI,MAAE;AACjC,AAAK,AAAC,6EAA6D,AAAiB,sCAAC,AAAqB,AAAC,sBAAE,AAAC;AAC9G,iBAAO,CAAC,AAAqB,AAAC;AAC/B;AACF;AACF;;AACD,WAAO,AAAc,AACvB;AAAC,AAED,AAAM;;;;;;;;;yBAA0B,AAAuB,SAAE,AAAe,SAAE,AAAmC,eAAE,AAAuB;AACpI,MAAI,AAAK,MAAC,AAAO,SAAE;AACjB,AAAK,AAAC,+BAAqB,AAAiB,sCAAC,AAAa,AAAC,cAAE,AAAC;AAC/D;;AAED,QAAM,AAAQ,WAAG,AAAa,cAAC,AAAQ;;AACvC,UAAQ,AAAQ,AAAE;AAChB,SAAK,AAAQ;AACX,aAAO,KAAI,AAAe,oCAAC,AAAO,SAAE,AAA8B,eAAE,AAAO,SAAE,AAAO,AAAC;;AAEvF,SAAK,AAAS;AACZ,aAAO,KAAI,AAAgB,sCAAC,AAAO,SAAE,AAA+B,eAAE,AAAO,SAAE,AAAO,AAAC;;AAEzF,SAAK,AAAS;AACZ,aAAO,AAAI;;AAEb;AACE,YAAM,AAAK,QAAG,AAAoB,qBAAC,AAAQ,AAAC;AAC5C,aAAO,AAAK,SAAI,AAAI,AAAC,AAAC,OAAC,AAAI,AAAC,AAAC,OAAC,IAAI,AAAK,MAAC,AAAO,SAAE,AAAa,AAAC,AAClE,AACH;;AAAC;;AAED,8BAA8B,AAAgB;AAC5C,UAAQ,AAAQ,AAAE;AAChB,SAAK,AAAQ;AACX,aAAO,AAAe;;AAExB,SAAK,AAAS;AACZ,aAAO,AAAgB;;AAEzB,SAAK,AAAS;AACZ,aAAO,AAAI;;AAEb,SAAK,AAAQ;AACX,aAAO,AAAO,AAAC,qCAA6B,AAAQ,QAAW,AAAC,aAAC,AAAO;;AAE1E;AACE,aAAO,AAAO,AAAC,8BAAsB,AAAQ,QAAE,AAAC,IAAC,AAAO,AAC3D,AACH;;AAAC,AAED,AAAM;;4BAA6B,AAA0C,sBAAE,AAAuB,UAAE,AAA+B;AACrI,MAAI,AAAoB,qBAAC,AAAQ,aAAK,AAAS,WAAE;AAC/C,UAAM,AAAa,gBAAI,AAA6C,qBAAC,AAAG;;AACxE,QAAI,AAAQ,YAAI,AAAI,MAAE;AACpB,aAAO,AAAa;AACrB;;AAED,UAAM,AAAO,UAAG,AAAG,MAAC,AAAK,MAAC,AAAa,AAAC;AACxC,iBAAW,AAAM,yBAAK,AAAwB;AAAE,AAAQ,gBAAE,AAAI,KAAC,AAAK,MAAC,AAAO,QAAC,AAAO,QAAC,AAAQ,YAAI,AAAG,KAAE,AAAS,UAAC,AAAQ,AAAC,AAAC,AAAE;MAArH,AAAG;AACX;;AAED,MAAI,AAAO;;AACX,MAAI,AAAoB,qBAAC,AAAQ,aAAK,AAAQ,UAAE;AAC9C,UAAM,AAAE,KAAG,AAAqC;AAChD,AAAO,AAAG,iBAAG,AAAS,qCAAC,AAAE,AAAC,OAAI,AAAE,GAAC,AAAK,SAAI,AAAE,GAAC,AAAI,0BAAsB,AAAE,GAAC,AAAgB,qBAAK,AAAK,AAAC,AAAC,QAAC,AAAE,AAAC,AAAC,KAAC,AAAG,MAAG,AAAQ,SAAC,AAAO,QAAC,AAAO,OAAE;AAC7I,SACI;AACH,AAAO,cAAG,AAAwB,oDAAC,AAAoB,AAAC;AACzD;;AAED,MAAI,AAAQ,YAAI,AAAI,MAAE;AACpB,WAAO,AAAO;AACf;;AACD,AAAO,YAAG,AAAO,WAAI,AAAS,UAAC,AAAQ,AAAC,SAAE,AAC5C;AAAC,AAED,AAAM;;;4CAAC,AAAK,WAA4B,AAA+B,UAAE,AAAsE,uBAAE,AAAiB,MAAE,AAAsB;AACxL,QAAI,AAAU,YAEd,AAA4B;;AAC5B,QAAI,AAAqB,yBAAI,AAAI,MAAE;AACjC,AAAU,mBAAG,AAAqB,sBAAC,AAAO,SAC1C,AAA6C;;AAC7C,UAAI,AAAU,eAAK,AAAI,MAAE;AACvB,eAAO,AAAI;AACZ;AACF,MAED,AAA6B;;;AAC7B,QAAI,AAAU,cAAI,AAAI,MAAE;AACtB,AAAU,mBAAG,AAAQ,SAAC,AAA4B,6BAAC,AAAO;;AAC1D,UAAI,AAAU,eAAK,AAAI,MAAE;AACvB,eAAO,AAAI;AACZ;AACF;;AAED,QAAI,AAAU,cAAI,AAAI,MAAE;AACtB,AAAU,mBAAG,AAAQ,SAAC,AAAM,OAAC,AAAO;;AACpC,UAAI,AAAU,eAAK,AAAI,MAAE;AACvB,eAAO,AAAI;AACZ;AACF;;AAED,QAAI,AAAU,cAAI,AAAI,MAAE;AACtB,UAAI,AAAW,cAA2B,AAAI;;AAC9C,UAAI,CAAC,AAAe,oCAAC,AAAO,QAAC,AAAG,IAAC,AAAQ,AAAC,aAAI,CAAC,AAAe,oCAAC,AAAO,QAAC,AAAG,IAAC,AAAY,AAAC,eAAE;AACxF,AAAW,sBAAG,AAAQ;AACvB,aACI,IAAI,CAAC,AAAe,oCAAC,AAAO,QAAC,AAAG,IAAC,AAAQ,AAAC,WAAE;AAC/C,AAAW,sBAAG,AAAS;AACxB;;AAED,UAAI,AAAW,eAAI,AAAI,MAAE;AACvB,AAAG,2BAAC,AAAK,MAAC,AAAI,AAAE,gBAAU,AAAW,WAAsB,AAAC;;AAC5D,eAAO,AAAC,CAAC,+BAA+B,AAAQ;AAAG,AAAQ,oBAAE,AAAW,AAAC;AAAvB,SAAnC,AAAwB,EAAoC,AAAI,MAAE,AAAa,AAAC,AAAE,AAAC;AACnG;AACF;;AAED,QAAI,AAAU,cAAI,AAAI,MAAE;AACtB,aAAO,AAAE;AACV;;AAED,AAAK,AAAC,wCAA8B,AAAiB,sCAAC,AAAU,AAAC,WAAE,AAAC;AACpE,WAAO,MAAO,AAAe,uBAAC,AAAG,IAAC,AAAO,4BAAC,AAAU,AAAC,aAAE,AAAE,AAAC,AAAE,+BAA0B,AAAQ,iBAAS,AAAE,OAAK,AAAQ,AAAC,AAAC;AAAE,AAAQ,gBAAE,AAAE,AAAC,AAAC,AAAC;AAAhB,KAAzB,GAA0C,AAAE,EAA/E,AAAwB,EAAyD,AAAI,MAAE,AAAa,AAAC,AAA0C,AAC9M;AAAC;;;;;;;;;AAED,iCAAiC,AAAc;AAC7C,MAAI,AAAM,OAAC,AAAI,SAAK,AAAM,UAAI,AAAM,OAAC,AAAO,WAAI,AAAI,QAAK,AAAM,OAAC,AAAe,QAAC,AAAoB,sBAAE;AACpG,WAAO,AAAI;AACZ;;AACD,SAAO,AAAM,OAAC,AAAI,SAAK,AAAM,UAAI,AAAM,OAAC,AAAI,KAAC,AAAU,WAAC,AAAO,AAAC,AAClE;AAAC;;AAED,6BAA6B,AAAY,SAAE,AAA+B,UAAE,AAAiB;AAC3F,OAAK,MAAM,AAAI,QAAI,AAAM,OAAC,AAAI,KAAC,AAAO,AAAC,UAAE;AACvC,UAAM,AAAK,QAAG,AAAO,QAAC,AAAI,AAAC;;AAC3B,QAAI,OAAO,AAAK,UAAK,AAAQ,UAAE;AAC7B,YAAM,AAAQ,WAAG,AAAQ,SAAC,AAAW,YAAC,AAAK,OAAE,AAAI,QAAI,AAAI,AAAC,AAAC,OAAC,AAAI,AAAC,AAAC,OAAC,AAAI,oBAAC,AAAI,AAAC,AAAC;;AAC9E,UAAI,AAAQ,aAAK,AAAK,OAAE;AACtB,AAAO,gBAAC,AAAI,AAAC,QAAG,AAAQ;AACzB;AACF;AACF,AACH;AAAC;;AAED,+BAA+B,AAA+B;AAC5D,QAAM,AAAK,QAAG,AAAQ,SAAC,AAA4B,6BAAC,AAAmB;AACvE,SAAO,AAAK,SAAI,AAAI,AAAC,AAAC,OAAC,AAAQ,SAAC,AAAM,OAAC,AAAmB,wBAAK,AAAK,AAAC,AAAC,QAAC,AAAK,AAC9E;AAAC","sourcesContent":["import BluebirdPromise from \"bluebird-lst\"\nimport { Arch, asArray, AsyncTaskManager, InvalidConfigurationError, isEmptyOrSpaces, isPullRequest, log, safeStringifyJson, serializeToYaml } from \"builder-util\"\nimport { BintrayOptions, CancellationToken, GenericServerOptions, getS3LikeProviderBaseUrl, GithubOptions, githubUrl, PublishConfiguration, PublishProvider } from \"builder-util-runtime\"\nimport _debug from \"debug\"\nimport { getCiTag, PublishContext, Publisher, PublishOptions } from \"electron-publish\"\nimport { BintrayPublisher } from \"electron-publish/out/BintrayPublisher\"\nimport { GitHubPublisher } from \"electron-publish/out/gitHubPublisher\"\nimport { MultiProgress } from \"electron-publish/out/multiProgress\"\nimport { writeFile } from \"fs-extra-p\"\nimport isCi from \"is-ci\"\nimport * as path from \"path\"\nimport { WriteStream as TtyWriteStream } from \"tty\"\nimport * as url from \"url\"\nimport { ArtifactCreated, Platform, PlatformSpecificBuildOptions, Target } from \"../index\"\nimport { Packager } from \"../packager\"\nimport { PlatformPackager } from \"../platformPackager\"\nimport { WinPackager } from \"../winPackager\"\nimport { createUpdateInfoTasks, UpdateInfoFileTask, writeUpdateInfoFiles } from \"./updateInfoBuilder\"\n\nconst publishForPrWarning = \"There are serious security concerns with PUBLISH_FOR_PULL_REQUEST=true (see the  CircleCI documentation (https://circleci.com/docs/1.0/fork-pr-builds/) for details)\" +\n  \"\\nIf you have SSH keys, sensitive env vars or AWS credentials stored in your project settings and untrusted forks can make pull requests against your repo, then this option isn't for you.\"\n\nconst debug = _debug(\"electron-builder:publish\")\n\nexport class PublishManager implements PublishContext {\n  private readonly nameToPublisher = new Map<string, Publisher | null>()\n\n  private readonly taskManager: AsyncTaskManager\n\n  private readonly isPublish: boolean = false\n\n  readonly progress = (process.stdout as TtyWriteStream).isTTY ? new MultiProgress() : null\n\n  private readonly updateFileWriteTask: Array<UpdateInfoFileTask> = []\n\n  constructor(private readonly packager: Packager, private readonly publishOptions: PublishOptions, readonly cancellationToken: CancellationToken = packager.cancellationToken) {\n    this.taskManager = new AsyncTaskManager(cancellationToken)\n\n    const forcePublishForPr = process.env.PUBLISH_FOR_PULL_REQUEST === \"true\"\n    if (!isPullRequest() || forcePublishForPr) {\n      if (publishOptions.publish === undefined) {\n        if (process.env.npm_lifecycle_event === \"release\") {\n          publishOptions.publish = \"always\"\n        }\n        else {\n          const tag = getCiTag()\n          if (tag != null) {\n            log.info({reason: \"tag is defined\", tag}, \"artifacts will be published\")\n            publishOptions.publish = \"onTag\"\n          }\n          else if (isCi) {\n            log.info({reason: \"CI detected\"}, \"artifacts will be published if draft release exists\")\n            publishOptions.publish = \"onTagOrDraft\"\n          }\n        }\n      }\n\n      const publishPolicy = publishOptions.publish\n      this.isPublish = publishPolicy != null && publishOptions.publish !== \"never\" && (publishPolicy !== \"onTag\" || getCiTag() != null)\n      if (this.isPublish && forcePublishForPr) {\n        log.warn(publishForPrWarning)\n      }\n    }\n    else if (publishOptions.publish !== \"never\") {\n      log.info({\n        reason: \"current build is a part of pull request\",\n        solution: `set env PUBLISH_FOR_PULL_REQUEST to true to force code signing\\n${publishForPrWarning}`,\n      }, \"publishing will be skipped\")\n    }\n\n    packager.addAfterPackHandler(async event => {\n      const packager = event.packager\n      if (event.electronPlatformName === \"darwin\") {\n        if (!event.targets.some(it => it.name === \"dmg\" || it.name === \"zip\")) {\n          return\n        }\n      }\n      else if (packager.platform === Platform.WINDOWS) {\n        if (!event.targets.some(it => isSuitableWindowsTarget(it))) {\n          return\n        }\n      }\n      else {\n        return\n      }\n\n      const publishConfig = await getAppUpdatePublishConfiguration(packager, event.arch, this.isPublish)\n      if (publishConfig != null) {\n        await writeFile(path.join(packager.getResourcesDir(event.appOutDir), \"app-update.yml\"), serializeToYaml(publishConfig))\n      }\n    })\n\n    packager.artifactCreated(event => {\n      const publishConfiguration = event.publishConfig\n      if (publishConfiguration == null) {\n        this.taskManager.addTask(this.artifactCreated(event))\n      }\n      else if (this.isPublish) {\n        if (debug.enabled) {\n          debug(`artifactCreated (isPublish: ${this.isPublish}): ${safeStringifyJson(event, new Set([\"packager\"]))},\\n  publishConfig: ${safeStringifyJson(publishConfiguration)}`)\n        }\n        this.scheduleUpload(publishConfiguration, event)\n      }\n    })\n  }\n\n  private scheduleUpload(publishConfig: PublishConfiguration, event: ArtifactCreated): void {\n    if (publishConfig.provider === \"generic\") {\n      return\n    }\n\n    const publisher = this.getOrCreatePublisher(publishConfig, event.packager)\n    if (publisher == null) {\n      log.debug({\n        file: event.file,\n        reason: \"publisher is null\",\n        publishConfig: safeStringifyJson(publishConfig),\n      }, \"not published\")\n      return\n    }\n\n    const providerName = publisher.providerName\n    if (this.publishOptions.publish === \"onTagOrDraft\" && getCiTag() == null && !(providerName === \"GitHub\" || providerName === \"Bintray\")) {\n      log.info({file: event.file, reason: \"current build is not for a git tag\", publishPolicy: \"onTagOrDraft\"}, `not published to ${providerName}`)\n      return\n    }\n\n    this.taskManager.addTask(publisher.upload(event))\n  }\n\n  private async artifactCreated(event: ArtifactCreated) {\n    const packager = event.packager\n    const target = event.target\n    const publishConfigs = event.publishConfig == null ? await getPublishConfigs(packager, target == null ? null : target.options, event.arch, this.isPublish) : [event.publishConfig]\n\n    if (debug.enabled) {\n      debug(`artifactCreated (isPublish: ${this.isPublish}): ${safeStringifyJson(event, new Set([\"packager\"]))},\\n  publishConfigs: ${safeStringifyJson(publishConfigs)}`)\n    }\n\n    const eventFile = event.file\n    if (publishConfigs == null) {\n      if (this.isPublish) {\n        log.debug({file: eventFile, reason: \"no publish configs\"}, \"not published\")\n      }\n      return\n    }\n\n    if (this.isPublish) {\n      for (const publishConfig of publishConfigs) {\n        if (this.cancellationToken.cancelled) {\n          log.debug({file: event.file, reason: \"cancelled\"}, \"not published\")\n          break\n        }\n\n        this.scheduleUpload(publishConfig, event)\n      }\n    }\n\n    if (event.isWriteUpdateInfo && target != null && eventFile != null &&\n      !this.cancellationToken.cancelled &&\n      (packager.platform !== Platform.WINDOWS || isSuitableWindowsTarget(target))) {\n      this.taskManager.addTask(createUpdateInfoTasks(event, publishConfigs).then(it => this.updateFileWriteTask.push(...it)))\n    }\n  }\n\n  private getOrCreatePublisher(publishConfig: PublishConfiguration, platformPackager: PlatformPackager<any>): Publisher | null {\n    // to not include token into cache key\n    const providerCacheKey = safeStringifyJson(publishConfig)\n    let publisher = this.nameToPublisher.get(providerCacheKey)\n    if (publisher == null) {\n      publisher = createPublisher(this, platformPackager.info.metadata.version!, publishConfig, this.publishOptions)\n      this.nameToPublisher.set(providerCacheKey, publisher)\n      log.info({publisher: publisher!!.toString()}, \"publishing\")\n    }\n    return publisher\n  }\n\n  // noinspection JSUnusedGlobalSymbols\n  cancelTasks() {\n    this.taskManager.cancelTasks()\n    this.nameToPublisher.clear()\n  }\n\n  async awaitTasks(): Promise<void> {\n    await this.taskManager.awaitTasks()\n\n    const updateInfoFileTasks = this.updateFileWriteTask\n    if (this.cancellationToken.cancelled || updateInfoFileTasks.length === 0) {\n      return\n    }\n\n    await writeUpdateInfoFiles(updateInfoFileTasks, this.packager)\n    await this.taskManager.awaitTasks()\n  }\n}\n\nexport async function getAppUpdatePublishConfiguration(packager: PlatformPackager<any>, arch: Arch, errorIfCannot: boolean) {\n  const publishConfigs = await getPublishConfigsForUpdateInfo(packager, await getPublishConfigs(packager, null, arch, errorIfCannot), arch)\n  if (publishConfigs == null || publishConfigs.length === 0) {\n    return null\n  }\n\n  let publishConfig = publishConfigs[0]\n\n  if (packager.platform === Platform.WINDOWS && publishConfig.publisherName == null) {\n    const winPackager = packager as WinPackager\n    if (winPackager.isForceCodeSigningVerification) {\n      const publisherName = await winPackager.computedPublisherName.value\n      if (publisherName != null) {\n        publishConfig = {...publishConfig, publisherName}\n      }\n    }\n  }\n  return publishConfig\n}\n\nexport async function getPublishConfigsForUpdateInfo(packager: PlatformPackager<any>, publishConfigs: Array<PublishConfiguration> | null, arch: Arch | null): Promise<Array<PublishConfiguration> | null> {\n  if (publishConfigs === null) {\n    return null\n  }\n\n  if (publishConfigs.length === 0) {\n    log.debug(null, \"getPublishConfigsForUpdateInfo: no publishConfigs, detect using repository info\")\n    // https://github.com/electron-userland/electron-builder/issues/925#issuecomment-261732378\n    // default publish config is github, file should be generated regardless of publish state (user can test installer locally or manage the release process manually)\n    const repositoryInfo = await packager.info.repositoryInfo\n    debug(`getPublishConfigsForUpdateInfo: ${safeStringifyJson(repositoryInfo)}`)\n    if (repositoryInfo != null && repositoryInfo.type === \"github\") {\n      const resolvedPublishConfig = await getResolvedPublishConfig(packager, {provider: repositoryInfo.type}, arch, false)\n      if (resolvedPublishConfig != null) {\n        debug(`getPublishConfigsForUpdateInfo: resolve to publish config ${safeStringifyJson(resolvedPublishConfig)}`)\n        return [resolvedPublishConfig]\n      }\n    }\n  }\n  return publishConfigs\n}\n\nexport function createPublisher(context: PublishContext, version: string, publishConfig: PublishConfiguration, options: PublishOptions): Publisher | null {\n  if (debug.enabled) {\n    debug(`Create publisher: ${safeStringifyJson(publishConfig)}`)\n  }\n\n  const provider = publishConfig.provider\n  switch (provider) {\n    case \"github\":\n      return new GitHubPublisher(context, publishConfig as GithubOptions, version, options)\n\n    case \"bintray\":\n      return new BintrayPublisher(context, publishConfig as BintrayOptions, version, options)\n\n    case \"generic\":\n      return null\n\n    default:\n      const clazz = requireProviderClass(provider)\n      return clazz == null ? null : new clazz(context, publishConfig)\n  }\n}\n\nfunction requireProviderClass(provider: string): any | null {\n  switch (provider) {\n    case \"github\":\n      return GitHubPublisher\n\n    case \"bintray\":\n      return BintrayPublisher\n\n    case \"generic\":\n      return null\n\n    case \"spaces\":\n      return require(`electron-publisher-s3/out/${provider}Publisher`).default\n\n    default:\n      return require(`electron-publisher-${provider}`).default\n  }\n}\n\nexport function computeDownloadUrl(publishConfiguration: PublishConfiguration, fileName: string | null, packager: PlatformPackager<any>) {\n  if (publishConfiguration.provider === \"generic\") {\n    const baseUrlString = (publishConfiguration as GenericServerOptions).url\n    if (fileName == null) {\n      return baseUrlString\n    }\n\n    const baseUrl = url.parse(baseUrlString)\n    return url.format({...baseUrl as url.UrlObject, pathname: path.posix.resolve(baseUrl.pathname || \"/\", encodeURI(fileName))})\n  }\n\n  let baseUrl\n  if (publishConfiguration.provider === \"github\") {\n    const gh = publishConfiguration as GithubOptions\n    baseUrl = `${githubUrl(gh)}/${gh.owner}/${gh.repo}/releases/download/${gh.vPrefixedTagName === false ? \"\" : \"v\"}${packager.appInfo.version}`\n  }\n  else {\n    baseUrl = getS3LikeProviderBaseUrl(publishConfiguration)\n  }\n\n  if (fileName == null) {\n    return baseUrl\n  }\n  return `${baseUrl}/${encodeURI(fileName)}`\n}\n\nexport async function getPublishConfigs(packager: PlatformPackager<any>, targetSpecificOptions: PlatformSpecificBuildOptions | null | undefined, arch: Arch | null, errorIfCannot: boolean): Promise<Array<PublishConfiguration> | null> {\n  let publishers\n\n  // check build.nsis (target)\n  if (targetSpecificOptions != null) {\n    publishers = targetSpecificOptions.publish\n    // if explicitly set to null - do not publish\n    if (publishers === null) {\n      return null\n    }\n  }\n\n  // check build.win (platform)\n  if (publishers == null) {\n    publishers = packager.platformSpecificBuildOptions.publish\n    if (publishers === null) {\n      return null\n    }\n  }\n\n  if (publishers == null) {\n    publishers = packager.config.publish\n    if (publishers === null) {\n      return null\n    }\n  }\n\n  if (publishers == null) {\n    let serviceName: PublishProvider | null = null\n    if (!isEmptyOrSpaces(process.env.GH_TOKEN) || !isEmptyOrSpaces(process.env.GITHUB_TOKEN)) {\n      serviceName = \"github\"\n    }\n    else if (!isEmptyOrSpaces(process.env.BT_TOKEN)) {\n      serviceName = \"bintray\"\n    }\n\n    if (serviceName != null) {\n      log.debug(null, `Detect ${serviceName} as publish provider`)\n      return [(await getResolvedPublishConfig(packager, {provider: serviceName}, arch, errorIfCannot))!]\n    }\n  }\n\n  if (publishers == null) {\n    return []\n  }\n\n  debug(`Explicit publish provider: ${safeStringifyJson(publishers)}`)\n  return await (BluebirdPromise.map(asArray(publishers), it => getResolvedPublishConfig(packager, typeof it === \"string\" ? {provider: it} : it, arch, errorIfCannot)) as Promise<Array<PublishConfiguration>>)\n}\n\nfunction isSuitableWindowsTarget(target: Target) {\n  if (target.name === \"appx\" && target.options != null && (target.options as any).electronUpdaterAware) {\n    return true\n  }\n  return target.name === \"nsis\" || target.name.startsWith(\"nsis-\")\n}\n\nfunction expandPublishConfig(options: any, packager: PlatformPackager<any>, arch: Arch | null): void {\n  for (const name of Object.keys(options)) {\n    const value = options[name]\n    if (typeof value === \"string\") {\n      const expanded = packager.expandMacro(value, arch == null ? null : Arch[arch])\n      if (expanded !== value) {\n        options[name] = expanded\n      }\n    }\n  }\n}\n\nfunction isDetectUpdateChannel(packager: PlatformPackager<any>) {\n  const value = packager.platformSpecificBuildOptions.detectUpdateChannel\n  return value == null ? packager.config.detectUpdateChannel !== false : value\n}\n\nasync function getResolvedPublishConfig(packager: PlatformPackager<any>, options: PublishConfiguration, arch: Arch | null, errorIfCannot: boolean): Promise<PublishConfiguration | GithubOptions | BintrayOptions | null> {\n  options = {...options}\n  expandPublishConfig(options, packager, arch)\n\n  let channelFromAppVersion: string | null = null\n  if ((options as GenericServerOptions).channel == null && isDetectUpdateChannel(packager)) {\n    channelFromAppVersion = packager.appInfo.channel\n  }\n\n  const provider = options.provider\n  if (provider === \"generic\") {\n    const o = options as GenericServerOptions\n    if (o.url == null) {\n      throw new InvalidConfigurationError(`Please specify \"url\" for \"generic\" update server`)\n    }\n\n    if (channelFromAppVersion != null) {\n      (o as any).channel = channelFromAppVersion\n    }\n    return options\n  }\n\n  const providerClass = requireProviderClass(options.provider)\n  if (providerClass != null && providerClass.checkAndResolveOptions != null) {\n    await providerClass.checkAndResolveOptions(options, channelFromAppVersion, errorIfCannot)\n    return options\n  }\n\n  const isGithub = provider === \"github\"\n  if (!isGithub && provider !== \"bintray\") {\n    return options\n  }\n\n  let owner = isGithub ? (options as GithubOptions).owner : (options as BintrayOptions).owner\n  let project = isGithub ? (options as GithubOptions).repo : (options as BintrayOptions).package\n\n  if (isGithub && owner == null && project != null) {\n    const index = project.indexOf(\"/\")\n    if (index > 0) {\n      const repo = project\n      project = repo.substring(0, index)\n      owner = repo.substring(index + 1)\n    }\n  }\n\n  async function getInfo() {\n    const info = await packager.info.repositoryInfo\n    if (info != null) {\n      return info\n    }\n\n    const message = `Cannot detect repository by .git/config. Please specify \"repository\" in the package.json (https://docs.npmjs.com/files/package.json#repository).\\nPlease see https://electron.build/configuration/publish`\n    if (errorIfCannot) {\n      throw new Error(message)\n    }\n    else {\n      log.warn(message)\n      return null\n    }\n  }\n\n  if (!owner || !project) {\n    log.debug({reason: \"owner or project is not specified explicitly\", provider, owner, project}, \"calling getInfo\")\n    const info = await getInfo()\n    if (info == null) {\n      return null\n    }\n\n    if (!owner) {\n      owner = info.user\n    }\n    if (!project) {\n      project = info.project\n    }\n  }\n\n  if (isGithub) {\n    if ((options as GithubOptions).token != null && !(options as GithubOptions).private) {\n      log.warn('\"token\" specified in the github publish options. It should be used only for [setFeedURL](module:electron-updater/out/AppUpdater.AppUpdater+setFeedURL).')\n    }\n    //tslint:disable-next-line:no-object-literal-type-assertion\n    return {owner, repo: project, ...options} as GithubOptions\n  }\n  else {\n    //tslint:disable-next-line:no-object-literal-type-assertion\n    return {owner, package: project, ...options} as BintrayOptions\n  }\n}"]}
